<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IA WebGen - Cr√©ateur de Sites Web Automatis√©</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
.gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.card-hover:hover { transform: translateY(-5px); transition: transform 0.3s ease; }
.fade-in { animation: fadeIn 0.8s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.preview-section { display: none; }
.auth-section { display: none; }
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: white; margin: 2% auto; padding: 20px; border-radius: 10px; width: 95%; max-width: 1200px; max-height: 95vh; overflow-y: auto; }
.notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001; display: none; }
.share-widget { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
.quality-templates { display: none; }
.photo-upload-area { border: 2px dashed #cbd5e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s; }
.photo-upload-area:hover { border-color: #3b82f6; background-color: #f0f9ff; }
.photo-upload-area.drag-over { border-color: #10b981; background-color: #f0fdf4; }
.template-card { cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
.template-card:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
.template-card.selected { border: 3px solid #10b981; background: #f0fdf4; }
.premium-badge { position: absolute; top: -8px; right: -8px; background: linear-gradient(45deg, #ffd700, #ffed4e); color: #1f2937; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; }
.preview-frame { border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.page-tab { padding: 8px 16px; margin: 2px; border-radius: 6px; cursor: pointer; transition: all 0.3s; background: #f3f4f6; }
.page-tab.active { background: #3b82f6; color: white; }
.page-tab:hover { background: #e5e7eb; }
.page-tab.active:hover { background: #2563eb; }
.checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
.checkbox-item { display: flex; align-items: center; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
.checkbox-item:hover { background: #f9fafb; border-color: #3b82f6; }
.checkbox-item input:checked + .checkbox-item { background: #eff6ff; border-color: #3b82f6; }
.loading-spinner { display: none; }
.email-section { display: none; }
.edit-mode .editable {
  position: relative;
  border: 2px dashed #3b82f6 !important;
  cursor: pointer;
}
.edit-mode .editable:hover {
  background-color: rgba(59, 130, 246, 0.1) !important;
}
.edit-toolbar {
  position: absolute;
  top: -40px;
  left: 0;
  background: #1f2937;
  border-radius: 6px;
  padding: 5px;
  display: flex;
  gap: 5px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.edit-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 5px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}
.edit-btn:hover {
  background: #2563eb;
}
.mini-chatgpt {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 350px;
  height: 500px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  z-index: 2000;
  display: none;
  flex-direction: column;
  overflow: hidden;
}
.mini-chatgpt.minimized {
  height: 60px;
}
.chatgpt-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}
.chatgpt-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.chatgpt-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #f8fafc;
}
.chatgpt-input-area {
  padding: 15px;
  border-top: 1px solid #e5e7eb;
  background: white;
}
.chatgpt-input {
  width: 100%;
  padding: 12px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  resize: none;
  font-family: inherit;
}
.message {
  margin-bottom: 15px;
  padding: 10px;
  border-radius: 10px;
  max-width: 80%;
}
.message.user {
  background: #3b82f6;
  color: white;
  margin-left: auto;
  text-align: right;
}
.message.bot {
  background: white;
  border: 1px solid #e5e7eb;
}
.chatgpt-toggle {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  color: white;
  font-size: 24px;
}
.image-search-result {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  margin-top: 10px;
}
.image-search-result img {
  width: 100%;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
  cursor: pointer;
  border: 2px solid transparent;
}
.image-search-result img:hover {
  border-color: #3b82f6;
}
</style>
</head>
<body class="font-sans">
<!-- Notification -->
<div id="notification" class="notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
<span id="notificationText">Message</span>
</div>

<!-- Widget de partage -->
<div class="share-widget">
<div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full shadow-lg p-3 relative">
<button onclick="toggleShareMenu()" class="flex items-center space-x-2 text-sm font-medium">
<i class="fas fa-share-alt"></i>
<span>Partager = -10%</span>
</button>
<div id="shareMenu" class="hidden absolute bottom-full right-0 mb-2 bg-white rounded-lg shadow-xl p-3 min-w-48">
<p class="text-gray-800 text-xs font-bold mb-2">üéÅ Partagez et √©conomisez 10% !</p>
<div class="flex gap-2">
<button onclick="shareOnFacebook()" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700 text-xs">
<i class="fab fa-facebook-f"></i>
</button>
<button onclick="shareOnTwitter()" class="bg-blue-400 text-white p-2 rounded hover:bg-blue-500 text-xs">
<i class="fab fa-twitter"></i>
</button>
<button onclick="shareOnWhatsApp()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 text-xs">
<i class="fab fa-whatsapp"></i>
</button>
<button onclick="copyLink()" class="bg-gray-600 text-white p-2 rounded hover:bg-gray-700 text-xs">
<i class="fas fa-link"></i>
</button>
</div>
<p class="text-gray-600 text-xs mt-2">Code: SHARE10</p>
</div>
</div>
</div>

<!-- Mini ChatGPT Toggle Button -->
<div id="chatgptToggle" class="chatgpt-toggle" onclick="toggleChatGPT()">
<i class="fas fa-robot"></i>
</div>

<!-- Mini ChatGPT Widget -->
<div id="miniChatGPT" class="mini-chatgpt">
<div class="chatgpt-header" onclick="toggleChatGPTSize()">
<div>
<h3 style="margin: 0; font-size: 16px;"><i class="fas fa-robot mr-2"></i>Assistant IA</h3>
<p style="margin: 0; font-size: 12px; opacity: 0.8;">Recherche web & assistance</p>
</div>
<div>
<button onclick="toggleChatGPTSize()" style="background: none; border: none; color: white; font-size: 16px;">
<i id="chatgptSizeIcon" class="fas fa-minus"></i>
</button>
<button onclick="closeChatGPT()" style="background: none; border: none; color: white; font-size: 16px; margin-left: 10px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<div class="chatgpt-body">
<div id="chatgptMessages" class="chatgpt-messages">
<div class="message bot">
<strong>ü§ñ Assistant IA</strong><br>
Salut ! Je peux t'aider √† :<br>
‚Ä¢ Modifier le site apr√®s pr√©visualisation<br>
‚Ä¢ Chercher des images : tapez "/image [description]"<br>
‚Ä¢ R√©pondre √† tes questions<br>
‚Ä¢ Sugg√©rer des am√©liorations<br><br>
Comment puis-je t'aider ?
</div>
</div>
<div class="chatgpt-input-area">
<textarea id="chatgptInput" class="chatgpt-input" placeholder="Tapez votre message... (Ex: /image restaurant moderne)" rows="3"></textarea>
<button onclick="sendChatGPTMessage()" style="margin-top: 10px; width: 100%; background: #3b82f6; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer;">
<i class="fas fa-paper-plane mr-2"></i>Envoyer
</button>
</div>
</div>
</div>

<!-- Application principale -->
<div id="app">
<p>Application en cours de chargement...</p>
</div>

<script>
// Variables globales
let websiteData = {};
let selectedTemplate = null;
let currentPage = 'accueil';
let generatedPages = {};
let editMode = false;
let chatGPTOpen = false;
let chatGPTMinimized = false;

// Configuration BACKEND_URL 
const BACKEND_URL = 'http://localhost:8001';

console.log('üöÄ IA WebGen Pro - Version corrig√©e initialis√©e');

// ========== FONCTIONS CHATGPT ==========
function toggleChatGPT() {
const chatgpt = document.getElementById('miniChatGPT');
const toggle = document.getElementById('chatgptToggle');

chatGPTOpen = !chatGPTOpen;
if (chatGPTOpen) {
chatgpt.style.display = 'flex';
toggle.style.display = 'none';
} else {
chatgpt.style.display = 'none';
toggle.style.display = 'flex';
}
}

function closeChatGPT() {
chatGPTOpen = false;
document.getElementById('miniChatGPT').style.display = 'none';
document.getElementById('chatgptToggle').style.display = 'flex';
}

function toggleChatGPTSize() {
const chatgpt = document.getElementById('miniChatGPT');
const icon = document.getElementById('chatgptSizeIcon');

chatGPTMinimized = !chatGPTMinimized;
if (chatGPTMinimized) {
chatgpt.classList.add('minimized');
icon.className = 'fas fa-plus';
} else {
chatgpt.classList.remove('minimized');
icon.className = 'fas fa-minus';
}
}

async function sendChatGPTMessage() {
const input = document.getElementById('chatgptInput');
const message = input.value.trim();
if (!message) return;

addChatMessage(message, 'user');
input.value = '';

// Traitement sp√©cial pour les commandes /image
if (message.startsWith('/image ')) {
const query = message.substring(7);
await searchImages(query);
} else {
// R√©ponse normale
setTimeout(() => {
let response = "Je peux t'aider ! Utilise '/image [description]' pour chercher des images.";
addChatMessage(response, 'bot');
}, 1000);
}
}

function addChatMessage(message, sender) {
const messagesContainer = document.getElementById('chatgptMessages');
const messageEl = document.createElement('div');
messageEl.className = `message ${sender}`;

if (sender === 'user') {
messageEl.innerHTML = message;
} else {
messageEl.innerHTML = `<strong>ü§ñ Assistant IA</strong><br>${message}`;
}

messagesContainer.appendChild(messageEl);
messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Recherche d'images via API backend
async function searchImages(query) {
addChatMessage(`üîç Recherche d'images pour: "${query}"...`, 'bot');

try {
const response = await fetch(`${BACKEND_URL}/api/images/search`, {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ query: query })
});

if (!response.ok) {
throw new Error(`HTTP error! status: ${response.status}`);
}

const data = await response.json();
console.log('Images re√ßues:', data);

if (data.success && data.images && data.images.length > 0) {
let imageResults = '<div class="image-search-result">';
data.images.forEach((image, index) => {
imageResults += `
<div class="image-item" style="position: relative; border-radius: 8px; overflow: hidden;">
<img src="${image.small_url}" alt="${image.alt_description}" 
     style="width: 100%; height: 120px; object-fit: cover; cursor: pointer;"
     onclick="selectSearchedImage('${image.url}', '${image.description}', '${image.id}')">
<div class="image-overlay" style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: white; padding: 8px; font-size: 12px;">
${image.description}
</div>
</div>
`;
});
imageResults += '</div>';

addChatMessage(`üì∏ Images pour "${query}" :<br>Clique sur une image pour l'utiliser !<br><br>${imageResults}`, 'bot');
} else {
addChatMessage(`‚ùå Aucune image trouv√©e pour "${query}".`, 'bot');
}
} catch (error) {
console.error('Erreur recherche d\'images:', error);
addChatMessage('‚ùå Erreur lors de la recherche d\'images. Backend indisponible.', 'bot');
}
}

function selectSearchedImage(imageUrl, description, imageId) {
alert(`Image s√©lectionn√©e: ${description}. Fonctionnalit√© d'application en cours de finalisation.`);
}

// ========== MODE √âDITION ==========
function toggleEditMode() {
editMode = !editMode;
const editModeBtn = document.getElementById('editModeBtn');
const editModeStatus = document.getElementById('editModeStatus');

if (editMode) {
if (editModeBtn) editModeBtn.classList.add('bg-orange-500');
if (editModeStatus) editModeStatus.textContent = 'Activ√©';
makeElementsEditable();
showNotification('‚úèÔ∏è Mode √©dition activ√© !');
} else {
if (editModeBtn) editModeBtn.classList.remove('bg-orange-500');
if (editModeStatus) editModeStatus.textContent = 'D√©sactiv√©';
removeEditableElements();
showNotification('‚úÖ Mode √©dition d√©sactiv√©.');
}
}

function makeElementsEditable() {
const editableElements = document.querySelectorAll('h1, h2, h3, p, span, button');
let count = 0;
editableElements.forEach(el => {
if (el.textContent && el.textContent.trim()) {
el.classList.add('editable');
el.addEventListener('click', handleElementClick);
count++;
}
});
console.log(`${count} √©l√©ments rendus √©ditables`);
}

function removeEditableElements() {
const editableElements = document.querySelectorAll('.editable');
editableElements.forEach(element => {
element.classList.remove('editable');
element.removeEventListener('click', handleElementClick);
});
}

function handleElementClick(event) {
if (!editMode) return;
event.preventDefault();
event.stopPropagation();

alert('√âdition en cours de d√©veloppement - fonctionnalit√© bient√¥t disponible');
}

// ========== FONCTIONS G√âN√âRALES ==========
function showNotification(message) {
const notification = document.getElementById('notification');
const text = document.getElementById('notificationText');
if (notification && text) {
text.textContent = message;
notification.style.display = 'block';
setTimeout(() => {
notification.style.display = 'none';
}, 3000);
}
console.log('üì¢', message);
}

function toggleShareMenu() {
const shareMenu = document.getElementById('shareMenu');
if (shareMenu) {
shareMenu.classList.toggle('hidden');
}
}

function shareOnFacebook() {
const url = encodeURIComponent(window.location.href);
window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnTwitter() {
const url = encodeURIComponent(window.location.href);
const text = encodeURIComponent('Cr√©ez votre site web professionnel avec IA WebGen Pro !');
window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareOnWhatsApp() {
const url = encodeURIComponent(window.location.href);
const text = encodeURIComponent('D√©couvrez IA WebGen Pro pour cr√©er votre site web professionnel !');
window.open(`https://wa.me/?text=${text} ${url}`, '_blank');
}

function copyLink() {
navigator.clipboard.writeText(window.location.href).then(() => {
showNotification('‚úÖ Lien copi√© !');
});
}

// ========== INITIALISATION ==========
document.addEventListener('DOMContentLoaded', function() {
console.log('‚úÖ IA WebGen Pro - Application simplifi√©e charg√©e');

// Configuration des touches du ChatGPT
const chatInput = document.getElementById('chatgptInput');
if (chatInput) {
chatInput.addEventListener('keypress', function(e) {
if (e.key === 'Enter' && !e.shiftKey) {
e.preventDefault();
sendChatGPTMessage();
}
});
}

// Interface simplifi√©e pour les tests
document.getElementById('app').innerHTML = `
<div class="min-h-screen bg-gray-100 p-8">
<div class="max-w-4xl mx-auto">
<h1 class="text-4xl font-bold text-center mb-8 text-gray-800">IA WebGen Pro - Tests Fonctionnalit√©s</h1>

<div class="grid md:grid-cols-2 gap-8">
<!-- Tests ChatGPT -->
<div class="bg-white p-6 rounded-lg shadow-lg">
<h2 class="text-2xl font-bold mb-4 text-blue-600">ü§ñ Tests ChatGPT</h2>
<p class="mb-4">1. Cliquez sur l'ic√¥ne robot en bas √† gauche</p>
<p class="mb-4">2. Tapez: <code>/image restaurant moderne</code></p>
<p class="mb-4">3. V√©rifiez que 4 images s'affichent</p>
<div class="bg-green-50 p-3 rounded">
<strong>‚úÖ Backend API:</strong> ${BACKEND_URL}/api/health
</div>
</div>

<!-- Tests Mode √âdition -->
<div class="bg-white p-6 rounded-lg shadow-lg">
<h2 class="text-2xl font-bold mb-4 text-purple-600">‚úèÔ∏è Tests Mode √âdition</h2>
<button id="editModeBtn" onclick="toggleEditMode()" class="w-full bg-purple-500 text-white py-3 rounded hover:bg-purple-600 mb-4">
Mode √âdition: <span id="editModeStatus">D√©sactiv√©</span>
</button>
<div id="testContent">
<h3>Titre √©ditable</h3>
<p>Ce paragraphe peut √™tre modifi√© en mode √©dition.</p>
<button class="bg-blue-500 text-white px-4 py-2 rounded">Bouton test</button>
</div>
</div>

<!-- Tests Ajout Section -->
<div class="bg-white p-6 rounded-lg shadow-lg">
<h2 class="text-2xl font-bold mb-4 text-green-600">‚ûï Tests Ajout Section</h2>
<button onclick="addNewSection()" class="w-full bg-green-500 text-white py-3 rounded hover:bg-green-600 mb-4">
Ajouter une section
</button>
<div id="newSections"></div>
</div>

<!-- Tests API Backend -->
<div class="bg-white p-6 rounded-lg shadow-lg">
<h2 class="text-2xl font-bold mb-4 text-red-600">üîß Tests API Backend</h2>
<button onclick="testBackendAPI()" class="w-full bg-red-500 text-white py-3 rounded hover:bg-red-600 mb-4">
Tester API Backend
</button>
<div id="apiResults" class="bg-gray-50 p-3 rounded min-h-20"></div>
</div>
</div>
</div>
</div>
`;

showNotification('‚úÖ Interface de test charg√©e - Pr√™t pour validation !');
});

// ========== FONCTIONS DE TEST ==========
function addNewSection() {
const container = document.getElementById('newSections');
const newSection = document.createElement('div');
newSection.className = 'bg-blue-50 p-4 rounded mb-4 border border-blue-200';
newSection.innerHTML = `
<h4 class="font-bold text-blue-800">Nouvelle section ajout√©e</h4>
<p class="text-blue-600">Section cr√©√©e le ${new Date().toLocaleTimeString()}</p>
<button onclick="this.parentElement.remove()" class="bg-red-500 text-white px-2 py-1 rounded text-sm mt-2">Supprimer</button>
`;
container.appendChild(newSection);
showNotification('‚úÖ Nouvelle section ajout√©e !');
}

async function testBackendAPI() {
const resultsDiv = document.getElementById('apiResults');
resultsDiv.innerHTML = '<p>üîÑ Test en cours...</p>';

try {
// Test 1: Health check
const healthResponse = await fetch(`${BACKEND_URL}/api/health`);
const healthData = await healthResponse.json();

// Test 2: Image search
const imageResponse = await fetch(`${BACKEND_URL}/api/images/search`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ query: 'restaurant' })
});
const imageData = await imageResponse.json();

resultsDiv.innerHTML = `
<div class="text-sm">
<p class="text-green-600">‚úÖ Health Check: ${healthData.status}</p>
<p class="text-green-600">‚úÖ Image Search: ${imageData.success ? imageData.images.length + ' images' : '√âchec'}</p>
<p class="text-blue-600">üîó Backend URL: ${BACKEND_URL}</p>
</div>
`;
} catch (error) {
resultsDiv.innerHTML = `<p class="text-red-600">‚ùå Erreur: ${error.message}</p>`;
}
}

// Gestion des erreurs
window.addEventListener('error', function(e) {
console.error('Erreur JavaScript:', e.error);
});

console.log('üéâ Toutes les fonctions charg√©es - Application pr√™te pour les tests');
</script>
</body>
</html>