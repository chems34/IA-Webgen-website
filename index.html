<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IA WebGen - Cr√©ateur de Sites Web Automatis√©</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
.gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.card-hover:hover { transform: translateY(-5px); transition: transform 0.3s ease; }
.fade-in { animation: fadeIn 0.8s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.preview-section { display: none; }
.auth-section { display: none; }
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: white; margin: 2% auto; padding: 20px; border-radius: 10px; width: 95%; max-width: 1200px; max-height: 95vh; overflow-y: auto; }
.notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001; display: none; }
.share-widget { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
.quality-templates { display: none; }
.photo-upload-area { border: 2px dashed #cbd5e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s; }
.photo-upload-area:hover { border-color: #3b82f6; background-color: #f0f9ff; }
.photo-upload-area.drag-over { border-color: #10b981; background-color: #f0fdf4; }
.template-card { cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
.template-card:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
.template-card.selected { border: 3px solid #10b981; background: #f0fdf4; }
.premium-badge { position: absolute; top: -8px; right: -8px; background: linear-gradient(45deg, #ffd700, #ffed4e); color: #1f2937; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; }
.preview-frame { border: 2px solid #e5e7eb; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.page-tab { padding: 8px 16px; margin: 2px; border-radius: 6px; cursor: pointer; transition: all 0.3s; background: #f3f4f6; }
.page-tab.active { background: #3b82f6; color: white; }
.page-tab:hover { background: #e5e7eb; }
.page-tab.active:hover { background: #2563eb; }
.checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
.checkbox-item { display: flex; align-items: center; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
.checkbox-item:hover { background: #f9fafb; border-color: #3b82f6; }
.checkbox-item input:checked + .checkbox-item { background: #eff6ff; border-color: #3b82f6; }
.loading-spinner { display: none; }
.email-section { display: none; }
.edit-mode .editable {
  position: relative;
  border: 2px dashed #3b82f6 !important;
  cursor: pointer;
}
.edit-mode .editable:hover {
  background-color: rgba(59, 130, 246, 0.1) !important;
}
.edit-toolbar {
  position: absolute;
  top: -40px;
  left: 0;
  background: #1f2937;
  border-radius: 6px;
  padding: 5px;
  display: flex;
  gap: 5px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.edit-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 5px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}
.edit-btn:hover {
  background: #2563eb;
}
.mini-chatgpt {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 350px;
  height: 500px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  z-index: 2000;
  display: none;
  flex-direction: column;
  overflow: hidden;
}
.mini-chatgpt.minimized {
  height: 60px;
}
.chatgpt-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}
.chatgpt-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.chatgpt-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #f8fafc;
}
.chatgpt-input-area {
  padding: 15px;
  border-top: 1px solid #e5e7eb;
  background: white;
}
.chatgpt-input {
  width: 100%;
  padding: 12px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  resize: none;
  font-family: inherit;
}
.message {
  margin-bottom: 15px;
  padding: 10px;
  border-radius: 10px;
  max-width: 80%;
}
.message.user {
  background: #3b82f6;
  color: white;
  margin-left: auto;
  text-align: right;
}
.message.bot {
  background: white;
  border: 1px solid #e5e7eb;
}
.chatgpt-toggle {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  color: white;
  font-size: 24px;
}
.image-search-result {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  margin-top: 10px;
}
.image-search-result img {
  width: 100%;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
  cursor: pointer;
  border: 2px solid transparent;
}
.image-search-result img:hover {
  border-color: #3b82f6;
}
</style>
</head>
<body class="font-sans">
<!-- Notification -->
<div id="notification" class="notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
<span id="notificationText">Message</span>
</div>

<!-- Widget de partage -->
<div class="share-widget">
<div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full shadow-lg p-3 relative">
<button onclick="toggleShareMenu()" class="flex items-center space-x-2 text-sm font-medium">
<i class="fas fa-share-alt"></i>
<span>Partager = -10%</span>
</button>
<div id="shareMenu" class="hidden absolute bottom-full right-0 mb-2 bg-white rounded-lg shadow-xl p-3 min-w-48">
<p class="text-gray-800 text-xs font-bold mb-2">üéÅ Partagez et √©conomisez 10% !</p>
<div class="flex gap-2">
<button onclick="shareOnFacebook()" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700 text-xs">
<i class="fab fa-facebook-f"></i>
</button>
<button onclick="shareOnTwitter()" class="bg-blue-400 text-white p-2 rounded hover:bg-blue-500 text-xs">
<i class="fab fa-twitter"></i>
</button>
<button onclick="shareOnWhatsApp()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 text-xs">
<i class="fab fa-whatsapp"></i>
</button>
<button onclick="copyLink()" class="bg-gray-600 text-white p-2 rounded hover:bg-gray-700 text-xs">
<i class="fas fa-link"></i>
</button>
</div>
<p class="text-gray-600 text-xs mt-2">Code: SHARE10</p>
</div>
</div>
</div>

<!-- Mini ChatGPT Toggle Button -->
<div id="chatgptToggle" class="chatgpt-toggle" onclick="toggleChatGPT()">
<i class="fas fa-robot"></i>
</div>

<!-- Mini ChatGPT Widget -->
<div id="miniChatGPT" class="mini-chatgpt">
<div class="chatgpt-header" onclick="toggleChatGPTSize()">
<div>
<h3 style="margin: 0; font-size: 16px;"><i class="fas fa-robot mr-2"></i>Assistant IA</h3>
<p style="margin: 0; font-size: 12px; opacity: 0.8;">Recherche web & assistance</p>
</div>
<div>
<button onclick="toggleChatGPTSize()" style="background: none; border: none; color: white; font-size: 16px;">
<i id="chatgptSizeIcon" class="fas fa-minus"></i>
</button>
<button onclick="closeChatGPT()" style="background: none; border: none; color: white; font-size: 16px; margin-left: 10px;">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<div class="chatgpt-body">
<div id="chatgptMessages" class="chatgpt-messages">
<div class="message bot">
<strong>ü§ñ Assistant IA</strong><br>
Salut ! Je peux t'aider √† :<br>
‚Ä¢ Modifier le site apr√®s pr√©visualisation<br>
‚Ä¢ Chercher des images : tapez "/image [description]"<br>
‚Ä¢ R√©pondre √† tes questions<br>
‚Ä¢ Sugg√©rer des am√©liorations<br><br>
Comment puis-je t'aider ?
</div>
</div>
<div class="chatgpt-input-area">
<textarea id="chatgptInput" class="chatgpt-input" placeholder="Tapez votre message... (Ex: /image restaurant moderne)" rows="3"></textarea>
<button onclick="sendChatGPTMessage()" style="margin-top: 10px; width: 100%; background: #3b82f6; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer;">
<i class="fas fa-paper-plane mr-2"></i>Envoyer
</button>
</div>
</div>
</div>

<!-- Header -->
<div class="gradient-bg text-white py-4 fade-in">
<div class="container mx-auto px-4">
<div class="flex justify-between items-center flex-wrap">
<h1 class="text-2xl font-bold">ü§ñ IA WebGen Pro</h1>
<div class="flex items-center gap-4">
<div class="text-sm">
<span class="bg-green-500 px-3 py-1 rounded-full text-xs sm:text-sm">
‚ú® Nouveau: Sites multi-pages complets !
</span>
</div>
<div id="authButtons" class="flex gap-2">
<button onclick="showLogin()" class="bg-white bg-opacity-20 px-4 py-2 rounded text-sm hover:bg-opacity-30">
<i class="fas fa-sign-in-alt"></i> Connexion
</button>
<button onclick="showRegister()" class="bg-green-500 px-4 py-2 rounded text-sm hover:bg-green-600">
<i class="fas fa-user-plus"></i> S'inscrire
</button>
</div>
<div id="userMenu" class="hidden">
<span id="userName" class="text-sm mr-4"></span>
<button onclick="logout()" class="bg-red-500 px-3 py-1 rounded text-sm hover:bg-red-600">
<i class="fas fa-sign-out-alt"></i> D√©connexion
</button>
</div>
</div>
</div>
</div>
</div>

<!-- Section principale -->
<div id="mainSection">
<!-- Hero Section -->
<section class="gradient-bg text-white py-20 fade-in">
<div class="container mx-auto px-4 text-center">
<h2 class="text-3xl sm:text-5xl font-bold mb-6">
üöÄ Cr√©ez votre site web professionnel complet avec l'IA
</h2>
<p class="text-lg sm:text-xl mb-8 opacity-90">
Intelligence artificielle avanc√©e + Sites multi-pages + Templates professionnels = Site parfait en 2-4h !
</p>
<div class="bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-lg p-6 sm:p-8 max-w-4xl mx-auto">
<h3 class="text-xl sm:text-2xl font-bold mb-6">üéØ Cr√©er mon site professionnel complet</h3>
<form id="websiteForm" class="space-y-6" onsubmit="handleFormSubmit(event)">
<!-- Informations de base -->
<div class="grid md:grid-cols-2 gap-4">
<input type="text" id="businessName" placeholder="Nom de votre entreprise"
class="w-full p-3 rounded-lg text-gray-800 font-medium" required>
<select id="siteType" class="w-full p-3 rounded-lg text-gray-800 font-medium" required>
<option value="">Type de site</option>
<option value="restaurant">üçΩÔ∏è Restaurant</option>
<option value="salon">üíá Salon de beaut√©</option>
<option value="commerce">üè™ Commerce/Boutique</option>
<option value="service">üîß Service professionnel</option>
<option value="medical">üè• Cabinet m√©dical</option>
<option value="immobilier">üè† Immobilier</option>
<option value="hotel">üè® H√¥tel/H√©bergement</option>
<option value="fitness">üí™ Salle de sport</option>
<option value="location-voiture">üöó Location de voiture</option>
<option value="avocat">‚öñÔ∏è Cabinet d'avocat</option>
<option value="photographe">üì∏ Photographe</option>
<option value="plombier">üîß Plomberie</option>
<option value="electricien">‚ö° √âlectricien</option>
<option value="garage">üîß Garage automobile</option>
<option value="artisan">üî® Artisan</option>
<option value="consultant">üíº Consultant</option>
<option value="association">ü§ù Association</option>
<option value="autre">‚ú® Autre activit√©</option>
</select>
</div>

<!-- Description d√©taill√©e -->
<textarea id="description" placeholder="D√©crivez votre activit√©, vos services et ce que vous souhaitez mettre en avant sur votre site..."
class="w-full p-3 rounded-lg text-gray-800 font-medium h-24" required></textarea>

<!-- Pages souhait√©es -->
<div class="bg-white bg-opacity-20 p-4 rounded-lg">
<h4 class="text-white font-bold mb-3">üìÑ Pages √† inclure dans votre site :</h4>
<div class="checkbox-group">
<label class="checkbox-item">
<input type="checkbox" id="page-accueil" checked disabled class="mr-2">
<span class="text-white text-sm">üè† Accueil (obligatoire)</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-apropos" checked class="mr-2">
<span class="text-white text-sm">üë• √Ä propos / Qui sommes-nous</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-services" checked class="mr-2">
<span class="text-white text-sm">‚öôÔ∏è Services / Produits</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-portfolio" class="mr-2">
<span class="text-white text-sm">üé® Portfolio / R√©alisations</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-equipe" class="mr-2">
<span class="text-white text-sm">üë®\u200düíº √âquipe</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-temoignages" class="mr-2">
<span class="text-white text-sm">üí¨ T√©moignages clients</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-blog" class="mr-2">
<span class="text-white text-sm">üìù Blog / Actualit√©s</span>
</label>
<label class="checkbox-item">
<input type="checkbox" id="page-contact" checked class="mr-2">
<span class="text-white text-sm">üìû Contact (obligatoire)</span>
</label>
</div>
</div>

<!-- Informations de contact -->
<div class="grid md:grid-cols-2 gap-4">
<input type="tel" id="phone" placeholder="T√©l√©phone (01 23 45 67 89)"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
<input type="email" id="userEmail" placeholder="Votre email professionnel"
class="w-full p-3 rounded-lg text-gray-800 font-medium" required>
</div>

<div class="grid md:grid-cols-2 gap-4">
<input type="text" id="address" placeholder="Adresse compl√®te"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
<input type="text" id="website" placeholder="Site web existant (optionnel)"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
</div>

<!-- R√©seaux sociaux -->
<div class="bg-white bg-opacity-20 p-4 rounded-lg">
<h4 class="text-white font-bold mb-3">üì± R√©seaux sociaux (optionnel) :</h4>
<div class="grid md:grid-cols-2 gap-4">
<input type="url" id="facebook" placeholder="https://facebook.com/votrepage"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
<input type="url" id="instagram" placeholder="https://instagram.com/votrepage"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
<input type="url" id="linkedin" placeholder="https://linkedin.com/company/votrepage"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
<input type="url" id="twitter" placeholder="https://twitter.com/votrepage"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
</div>
</div>

<!-- Upload de photos -->
<div class="photo-upload-area" id="photoUploadArea">
<div class="mb-4">
<i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
<h4 class="text-gray-800 font-bold text-lg mb-2">üì∏ Ajoutez vos photos (fortement recommand√©)</h4>
<p class="text-gray-600 text-sm mb-4">
Glissez vos images ici ou cliquez pour s√©lectionner<br>
<span class="text-xs">Photos de votre √©tablissement, √©quipe, r√©alisations - JPG, PNG, WebP - Max 5 Mo par image</span>
</p>
<input type="file" id="photoInput" multiple accept="image/*" class="hidden">
<button type="button" onclick="document.getElementById('photoInput').click()"
class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
<i class="fas fa-upload mr-2"></i>Choisir des photos
</button>
</div>
<div id="photoPreview" class="grid grid-cols-3 gap-2 mt-4 hidden"></div>
</div>

<!-- D√©tails suppl√©mentaires -->
<div class="bg-white bg-opacity-20 p-4 rounded-lg">
<h4 class="text-white font-bold mb-3">‚ú® D√©tails suppl√©mentaires :</h4>
<div class="space-y-3">
<textarea id="teamInfo" placeholder="Pr√©sentez votre √©quipe (noms, r√¥les, exp√©riences...)"
class="w-full p-3 rounded-lg text-gray-800 font-medium h-20"></textarea>
<textarea id="servicesDetail" placeholder="D√©taillez vos services/produits avec tarifs si souhait√©..."
class="w-full p-3 rounded-lg text-gray-800 font-medium h-20"></textarea>
<input type="text" id="slogan" placeholder="Votre slogan ou phrase d'accroche"
class="w-full p-3 rounded-lg text-gray-800 font-medium">
</div>
</div>

<button type="submit" class="w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-lg transform hover:scale-105 transition-all duration-200 text-lg">
üé® G√âN√âRER MON SITE COMPLET
</button>
</form>
</div>
</div>
</section>

<!-- Service Conciergerie -->
<section class="py-16 bg-gray-50 fade-in">
<div class="container mx-auto px-4">
<div class="text-center mb-12">
<h3 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-4">
ü§ñ IA Professionnelle + Service Conciergerie
</h3>
<p class="text-lg sm:text-xl text-gray-600">
Notre IA cr√©e des sites complets avec toutes les pages demand√©es !
</p>
</div>
<div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
<!-- Offre Site Seul -->
<div class="bg-white rounded-lg shadow-lg p-6 sm:p-8 card-hover">
<div class="text-center">
<h4 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">üìÑ Site IA Pro Multi-Pages</h4>
<div class="text-3xl sm:text-4xl font-bold text-blue-600 mb-4">GRATUIT</div>
<ul class="text-left space-y-2 mb-6 text-sm sm:text-base">
<li>‚úÖ Site multi-pages complet</li>
<li>‚úÖ 10 th√®mes professionnels</li>
<li>‚úÖ Contenus professionnels r√©dig√©s</li>
<li>‚úÖ Int√©gration de vos photos</li>
<li>‚úÖ Formulaires fonctionnels</li>
<li>‚úÖ Responsive design</li>
<li>‚úÖ Optimisation SEO de base</li>
<li>‚úÖ Code source propre</li>
<li>‚úÖ Livraison par email</li>
</ul>
</div>
</div>
<!-- Offre Conciergerie -->
<div class="bg-gradient-to-br from-green-500 to-blue-600 text-white rounded-lg shadow-lg p-6 sm:p-8 card-hover relative">
<div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-orange-500 px-3 py-1 rounded-full text-xs sm:text-sm font-bold">
üî• LE PLUS POPULAIRE
</div>
<div class="text-center mt-4">
<h4 class="text-xl sm:text-2xl font-bold mb-4">ü§ñ Conciergerie IA Compl√®te</h4>
<div class="text-3xl sm:text-4xl font-bold mb-4">GRATUIT</div>
<ul class="text-left space-y-2 mb-6 text-sm sm:text-base">
<li>‚úÖ <strong>Site multi-pages premium</strong></li>
<li>‚úÖ <strong>Tous les th√®mes premium inclus</strong></li>
<li>‚úÖ <strong>G√©n√©ration instantan√©e</strong></li>
<li>‚úÖ <strong>Livraison par email</strong></li>
<li>‚úÖ <strong>Site pr√™t en quelques minutes</strong></li>
<li>‚úÖ <strong>Optimisation SEO avanc√©e</strong></li>
<li>‚úÖ <strong>Code source complet</strong></li>
<li>‚úÖ <strong>Support technique inclus</strong></li>
<li>‚úÖ <strong>Personnalisation compl√®te</strong></li>
</ul>
<div class="bg-yellow-400 text-gray-800 p-3 rounded-lg text-xs sm:text-sm font-bold mb-4">
‚è∞ Site professionnel complet livr√© par email !<br>
üé® Personnalisation illimit√©e incluse
</div>
</div>
</div>
</div>
</div>
</section>
</div>

<!-- Section Templates -->
<section id="qualityTemplates" class="quality-templates py-16 bg-gray-50">
<div class="container mx-auto px-4">
<div class="text-center mb-12">
<h3 class="text-3xl font-bold text-gray-800 mb-4">üé® Choisissez votre th√®me professionnel</h3>
<p class="text-xl text-gray-600">10 th√®mes professionnels gratuits</p>
<button onclick="goBackToMain()" class="mt-4 bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">
<i class="fas fa-arrow-left mr-2"></i>Modifier les informations
</button>
</div>
<div id="templateGrid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-7xl mx-auto">
<!-- Les templates seront g√©n√©r√©s ici -->
</div>
<div class="text-center mt-8">
<button onclick="proceedWithSelectedTemplate()" id="continueBtn"
class="bg-green-500 text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
<i class="fas fa-eye mr-2"></i>VOIR LA PR√âVISUALISATION COMPL√àTE
</button>
</div>
</div>
</section>

<!-- Section Pr√©visualisation -->
<section id="previewSection" class="preview-section min-h-screen bg-gray-100 py-8">
<div class="container mx-auto px-4">
<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
<div class="flex justify-between items-center mb-4">
<h2 class="text-2xl font-bold text-gray-800">
üéâ Pr√©visualisation compl√®te : <span id="previewBusinessName"></span>
</h2>
<div class="flex gap-3">
<button onclick="goBackToTemplates()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
<i class="fas fa-palette mr-2"></i>Changer de th√®me
</button>
<button onclick="goBackToMain()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
<i class="fas fa-edit mr-2"></i>Modifier infos
</button>
</div>
</div>

<!-- Navigation des pages -->
<div class="mb-6">
<div class="flex flex-wrap gap-2 justify-center" id="pageNavigation">
<!-- Les onglets des pages seront g√©n√©r√©s ici -->
</div>
</div>

<div class="grid lg:grid-cols-3 gap-8">
<!-- Aper√ßu du site -->
<div class="lg:col-span-2">
<h3 class="text-lg font-bold mb-4">üì± Aper√ßu de votre site complet</h3>
<div id="websitePreview" class="preview-frame bg-white overflow-auto" style="height: 600px;">
<div style="padding: 50px; text-align: center; color: #6b7280;">
<i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 20px;"></i>
<p style="font-size: 1.2rem;">G√©n√©ration de votre site complet en cours...</p>
<p style="font-size: 0.9rem; margin-top: 10px;">Cr√©ation des pages, int√©gration des contenus...</p>
</div>
</div>
</div>

<!-- Options de personnalisation -->
<div>
<h3 class="text-lg font-bold mb-4">‚úèÔ∏è Personnalisez votre site</h3>
<div class="space-y-4">
<div>
<button onclick="toggleEditMode()" id="editModeBtn" class="w-full bg-purple-500 text-white py-3 rounded hover:bg-purple-600 mb-4">
<i class="fas fa-edit mr-2"></i>Mode √âdition: <span id="editModeStatus">D√©sactiv√©</span>
</button>
</div>
<div>
<label class="block text-sm font-bold mb-2">Couleur principale</label>
<input type="color" id="primaryColor" value="#3b82f6" class="w-full h-10 rounded" onchange="updatePreview()">
</div>
<div>
<label class="block text-sm font-bold mb-2">Couleur secondaire</label>
<input type="color" id="secondaryColor" value="#1e40af" class="w-full h-10 rounded" onchange="updatePreview()">
</div>
<div>
<label class="block text-sm font-bold mb-2">Titre principal</label>
<input type="text" id="mainTitle" class="w-full p-3 border rounded-lg" onchange="updatePreview()">
</div>
<div>
<label class="block text-sm font-bold mb-2">Slogan/Sous-titre</label>
<textarea id="subtitle" class="w-full p-3 border rounded-lg h-20" onchange="updatePreview()"></textarea>
</div>
<button onclick="updatePreview()" class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
üîÑ Mettre √† jour l'aper√ßu
</button>
<button onclick="addNewSection()" class="w-full bg-green-500 text-white py-3 rounded hover:bg-green-600 mt-2">
‚ûï Ajouter une section
</button>
</div>

<!-- Finaliser commande -->
<div class="mt-8 border-t pt-6">
<h3 class="text-lg font-bold mb-4">üéâ Finaliser et recevoir</h3>
<div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
<h4 class="font-bold text-green-800">‚úÖ Site Multi-Pages Complet</h4>
<p class="text-sm text-green-700">Tous les fichiers sources + Instructions</p>
<p class="font-bold text-green-600 mt-2">GRATUIT - Livraison par email</p>
</div>
<button onclick="finalizeAndSend()" class="w-full bg-green-500 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-green-600 transform hover:scale-105 transition-all">
üìß RECEVOIR MON SITE PAR EMAIL
</button>
</div>
</div>
</div>
</div>
</div>
</section>

<!-- Section Email Final -->
<section id="emailSection" class="email-section min-h-screen bg-gray-100 py-8">
<div class="container mx-auto px-4 max-w-2xl">
<div class="bg-white rounded-lg shadow-lg p-8">
<div class="text-center mb-8">
<div class="text-6xl mb-4">üéâ</div>
<h2 class="text-3xl font-bold text-gray-800 mb-4">F√©licitations !</h2>
<p class="text-lg text-gray-600">Votre site professionnel complet est pr√™t</p>
</div>

<div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
<h3 class="text-xl font-bold text-green-800 mb-4">üì¶ Votre package inclut :</h3>
<ul class="space-y-2 text-green-700">
<li>‚úÖ <span id="finalPageCount">Site multi-pages complet</span></li>
<li>‚úÖ Code HTML/CSS/JS professionnel</li>
<li>‚úÖ Images optimis√©es int√©gr√©es</li>
<li>‚úÖ Design responsive (mobile/desktop)</li>
<li>‚úÖ Formulaires de contact fonctionnels</li>
<li>‚úÖ Instructions de mise en ligne</li>
<li>‚úÖ Support technique gratuit</li>
</ul>
</div>

<form id="finalEmailForm" onsubmit="sendWebsiteEmail(event)" class="space-y-6">
<div>
<label class="block text-lg font-bold mb-3">üìß Adresse email de livraison :</label>
<input type="email" id="deliveryEmail" class="w-full p-4 border-2 rounded-lg text-lg" 
       placeholder="votre@email.com" required>
<p class="text-sm text-gray-600 mt-2">Nous enverrons votre site complet avec toutes les instructions</p>
</div>

<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
<h4 class="font-bold text-blue-800 mb-2">‚è∞ D√©lai de livraison</h4>
<p class="text-blue-700 text-sm">Vous recevrez votre site dans les 5 minutes suivant la validation</p>
</div>

<button type="submit" id="sendEmailBtn" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-4 px-6 rounded-lg font-bold text-xl hover:from-green-600 hover:to-blue-600 transform hover:scale-105 transition-all">
<i class="fas fa-paper-plane mr-3"></i>ENVOYER MON SITE MAINTENANT
</button>
</form>

<div id="loadingSpinner" class="loading-spinner text-center py-8">
<i class="fas fa-spinner fa-spin text-4xl text-blue-500 mb-4"></i>
<p class="text-lg font-bold text-gray-700">Pr√©paration de votre site...</p>
<p class="text-sm text-gray-600">G√©n√©ration des fichiers et envoi en cours</p>
</div>

<div id="successMessage" class="loading-spinner text-center py-8">
<div class="text-6xl mb-4">‚úÖ</div>
<h3 class="text-2xl font-bold text-green-600 mb-4">Site envoy√© avec succ√®s !</h3>
<p class="text-lg text-gray-700 mb-4">V√©rifiez votre bo√Æte email (et vos spams)</p>
<button onclick="createNewSite()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
üöÄ Cr√©er un nouveau site
</button>
</div>
</div>
</div>
</section>

<!-- Modal d'authentification -->
<div id="authModal" class="modal">
<div class="modal-content max-w-md">
<div class="flex justify-between items-center mb-6">
<h2 id="authModalTitle" class="text-2xl font-bold">Connexion</h2>
<button onclick="closeAuthModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<!-- Connexion -->
<div id="loginForm" class="auth-section">
<form onsubmit="login(event)" class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Email</label>
<input type="email" id="loginEmail" class="w-full p-3 border rounded-lg" required>
</div>
<div>
<label class="block text-sm font-bold mb-2">Mot de passe</label>
<input type="password" id="loginPassword" class="w-full p-3 border rounded-lg" required>
</div>
<button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
Se connecter
</button>
</form>
<p class="mt-4 text-center">
<a href="#" onclick="showRegisterForm()" class="text-blue-500 hover:underline">Pas de compte ? S'inscrire</a>
</p>
</div>
<!-- Inscription -->
<div id="registerForm" class="auth-section">
<form onsubmit="register(event)" class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Nom complet</label>
<input type="text" id="registerName" class="w-full p-3 border rounded-lg" required>
</div>
<div>
<label class="block text-sm font-bold mb-2">Email</label>
<input type="email" id="registerEmail" class="w-full p-3 border rounded-lg" required>
</div>
<div>
<label class="block text-sm font-bold mb-2">Mot de passe</label>
<input type="password" id="registerPassword" class="w-full p-3 border rounded-lg" required>
</div>
<button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">
S'inscrire
</button>
</form>
<p class="mt-4 text-center">
<a href="#" onclick="showLoginForm()" class="text-blue-500 hover:underline">D√©j√† un compte ? Se connecter</a>
</p>
</div>
</div>
</div>

<script>
// Variables globales
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
let websiteData = {};
let selectedTemplate = null;
let uploadedPhotos = [];
let allTemplates = [];
let currentPage = 'accueil';
let generatedPages = {};
let editMode = false;
let chatGPTOpen = false;
let chatGPTMinimized = false;

// Templates professionnels - TOUS GRATUITS
const TEMPLATES = [
{
id: 'modern-clean',
name: 'Modern Clean',
description: 'Design √©pur√© et moderne',
isPremium: false,
colors: { primary: '#3b82f6', secondary: '#1e40af' },
gradient: 'from-blue-400 to-blue-600'
},
{
id: 'business-pro',
name: 'Business Pro',
description: 'Professionnel et √©l√©gant',
isPremium: false,
colors: { primary: '#374151', secondary: '#111827' },
gradient: 'from-gray-600 to-gray-800'
},
{
id: 'creative-studio',
name: 'Creative Studio',
description: 'Cr√©atif et artistique',
isPremium: false,
colors: { primary: '#f59e0b', secondary: '#dc2626' },
gradient: 'from-orange-400 to-red-500'
},
{
id: 'fresh-green',
name: 'Fresh Green',
description: 'Nature et √©co-responsable',
isPremium: false,
colors: { primary: '#10b981', secondary: '#047857' },
gradient: 'from-green-400 to-emerald-600'
},
{
id: 'tech-innovation',
name: 'Tech Innovation',
description: 'High-tech et futuriste',
isPremium: false,
colors: { primary: '#8b5cf6', secondary: '#7c3aed' },
gradient: 'from-purple-500 to-cyan-500'
},
{
id: 'warm-elegance',
name: 'Warm Elegance',
description: 'Chaleureux et accueillant',
isPremium: false,
colors: { primary: '#f97316', secondary: '#ea580c' },
gradient: 'from-orange-500 to-amber-600'
},
{
id: 'classic-minimal',
name: 'Classic Minimal',
description: 'Classique et minimaliste',
isPremium: false,
colors: { primary: '#6b7280', secondary: '#374151' },
gradient: 'from-slate-400 to-slate-600'
},
{
id: 'luxury-gold',
name: 'Luxury Gold',
description: 'Premium avec animations dor√©es',
isPremium: false,
colors: { primary: '#f59e0b', secondary: '#d97706' },
gradient: 'from-yellow-400 to-amber-600'
},
{
id: 'royal-purple',
name: 'Royal Purple',
description: 'Design royal avec effets premium',
isPremium: false,
colors: { primary: '#a855f7', secondary: '#7c3aed' },
gradient: 'from-purple-500 to-indigo-600'
},
{
id: 'diamond-elite',
name: 'Diamond Elite',
description: 'Ultra-premium avec cristaux',
isPremium: false,
colors: { primary: '#6b7280', secondary: '#374151' },
gradient: 'from-slate-400 to-slate-700'
}
];

// ========== INITIALISATION ==========
document.addEventListener('DOMContentLoaded', function() {
console.log('üöÄ IA WebGen Pro - Initialisation d√©marr√©e');

// V√©rifier la session utilisateur
if (currentUser) {
showUserMenu();
}

// Initialiser l'upload de photos
setupPhotoUpload();
allTemplates = TEMPLATES;

console.log('‚úÖ Initialisation termin√©e');
});

// ========== GESTION FORMULAIRE ==========
function handleFormSubmit(event) {
console.log('üî• TRAITEMENT FORMULAIRE');
event.preventDefault();
event.stopPropagation();

try {
generateCompleteWebsite();
} catch (error) {
console.error('‚ùå ERREUR:', error);
showNotification('‚ùå Erreur lors de la g√©n√©ration. Veuillez r√©essayer.');
}
}

// G√âN√âRATION COMPL√àTE DU SITE
function generateCompleteWebsite() {
console.log('üé® G√âN√âRATION DU SITE COMPLET');

// R√©cup√©rer toutes les donn√©es
const businessName = document.getElementById('businessName').value.trim();
const description = document.getElementById('description').value.trim();
const siteType = document.getElementById('siteType').value;
const userEmail = document.getElementById('userEmail').value.trim();
const phone = document.getElementById('phone').value.trim();
const address = document.getElementById('address').value.trim();
const website = document.getElementById('website').value.trim();
const slogan = document.getElementById('slogan').value.trim();
const teamInfo = document.getElementById('teamInfo').value.trim();
const servicesDetail = document.getElementById('servicesDetail').value.trim();

// R√©seaux sociaux
const facebook = document.getElementById('facebook').value.trim();
const instagram = document.getElementById('instagram').value.trim();
const linkedin = document.getElementById('linkedin').value.trim();
const twitter = document.getElementById('twitter').value.trim();

// Pages s√©lectionn√©es
const selectedPages = [];
document.querySelectorAll('input[id^="page-"]:checked').forEach(checkbox => {
selectedPages.push(checkbox.id.replace('page-', ''));
});

// Validation
if (!businessName || businessName.length < 2) {
showNotification('‚ùå Le nom de votre entreprise est requis');
return;
}
if (!description || description.length < 10) {
showNotification('‚ùå Veuillez d√©crire votre activit√©');
return;
}
if (!siteType) {
showNotification('‚ùå Veuillez s√©lectionner le type de site');
return;
}
if (!userEmail || !userEmail.includes('@')) {
showNotification('‚ùå Veuillez saisir un email valide');
return;
}

// Stocker toutes les donn√©es
websiteData = {
businessName,
description,
siteType,
userEmail,
phone,
address,
website,
slogan,
teamInfo,
servicesDetail,
socialMedia: { facebook, instagram, linkedin, twitter },
selectedPages,
photos: uploadedPhotos,
mainTitle: businessName,
subtitle: slogan || description,
primaryColor: '#3b82f6',
secondaryColor: '#1e40af'
};

console.log('üíæ Donn√©es stock√©es:', websiteData);

// Afficher les templates
displayTemplates();

// Navigation
document.getElementById('mainSection').style.display = 'none';
document.getElementById('qualityTemplates').style.display = 'block';
document.getElementById('previewSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'none';
window.scrollTo(0, 0);

showNotification(`‚úÖ Site ${selectedPages.length} pages pr√™t ! Choisissez votre th√®me.`);
}

// ========== AFFICHAGE TEMPLATES ==========
function displayTemplates() {
console.log('üñºÔ∏è Affichage des templates...');
const templateGrid = document.getElementById('templateGrid');
if (!templateGrid) return;

templateGrid.innerHTML = '';

allTemplates.forEach((template, index) => {
const templateCard = document.createElement('div');
templateCard.className = 'template-card bg-white rounded-xl shadow-lg p-4 border-2 border-gray-200 relative hover:shadow-xl transition-all';
templateCard.onclick = () => selectTemplate(index);

let previewContent = generateTemplatePreview(template);

templateCard.innerHTML = `
<div class="mb-4">
<div class="bg-gradient-to-br ${template.gradient} h-24 rounded-lg flex items-center justify-center text-white font-bold text-sm shadow-inner">
${previewContent}
</div>
</div>
<div class="text-center">
<h4 class="font-bold text-base mb-1">${template.name}</h4>
<p class="text-gray-600 text-xs mb-2">${template.description}</p>
<div class="text-center">
<span class="text-xs font-bold px-2 py-1 rounded bg-green-100 text-green-700">
‚ú® Gratuit
</span>
</div>
</div>
`;
templateGrid.appendChild(templateCard);
});

console.log('‚úÖ Templates affich√©s');
}

function generateTemplatePreview(template) {
switch(template.id) {
case 'modern-clean':
return '<div style="text-align: center; padding: 15px;"><div style="width: 60px; height: 4px; background: white; margin: 0 auto 8px; border-radius: 2px; opacity: 0.9;"></div><div style="font-size: 14px; font-weight: bold;">MODERN</div></div>';
case 'business-pro':
return '<div style="text-align: center; padding: 15px;"><div style="width: 30px; height: 30px; border: 2px solid white; border-radius: 50%; margin: 0 auto 8px; opacity: 0.9;"></div><div style="font-size: 14px; font-weight: bold;">BUSINESS</div></div>';
case 'luxury-gold':
return '<div style="text-align: center; padding: 15px;"><div style="font-size: 20px;">üíé</div><div style="font-size: 14px; font-weight: bold;">LUXURY</div></div>';
default:
return `<div style="text-align: center; padding: 15px;"><div style="font-size: 14px; font-weight: bold;">${template.name.toUpperCase()}</div></div>`;
}
}

// ========== S√âLECTION TEMPLATE ==========
function selectTemplate(index) {
console.log('üéØ Template s√©lectionn√©:', index);
document.querySelectorAll('.template-card').forEach(card => {
card.classList.remove('selected');
});
const selectedCard = document.querySelectorAll('.template-card')[index];
if (selectedCard) {
selectedCard.classList.add('selected');
}
selectedTemplate = index;

if (allTemplates[index]) {
websiteData.primaryColor = allTemplates[index].colors.primary;
websiteData.secondaryColor = allTemplates[index].colors.secondary;
}

const continueBtn = document.getElementById('continueBtn');
if (continueBtn) {
continueBtn.disabled = false;
}
showNotification(`‚úÖ Th√®me "${allTemplates[index].name}" s√©lectionn√© !`);
}

// ========== PR√âVISUALISATION ==========
function proceedWithSelectedTemplate() {
console.log('üëÅÔ∏è G√©n√©ration de la pr√©visualisation...');
if (selectedTemplate === null) {
showNotification('‚ùå Veuillez s√©lectionner un th√®me !');
return;
}

try {
// G√©n√©rer toutes les pages
generateAllPages();

// Navigation
document.getElementById('qualityTemplates').style.display = 'none';
document.getElementById('previewSection').style.display = 'block';
document.getElementById('mainSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'none';

// Initialiser la pr√©visualisation
initializeCompletePreview();
window.scrollTo(0, 0);
} catch (error) {
console.error('‚ùå Erreur pr√©visualisation:', error);
showNotification('‚ùå Erreur lors de la pr√©visualisation');
}
}

function generateAllPages() {
console.log('üìÑ G√©n√©ration de toutes les pages...');
generatedPages = {};

websiteData.selectedPages.forEach(page => {
generatedPages[page] = generatePageContent(page);
});
console.log('‚úÖ Pages g√©n√©r√©es:', Object.keys(generatedPages));
}

function initializeCompletePreview() {
console.log('üîÑ Initialisation pr√©visualisation...');
const previewBusinessName = document.getElementById('previewBusinessName');
const mainTitle = document.getElementById('mainTitle');
const subtitle = document.getElementById('subtitle');
const primaryColor = document.getElementById('primaryColor');
const secondaryColor = document.getElementById('secondaryColor');

if (previewBusinessName) previewBusinessName.textContent = websiteData.businessName;
if (mainTitle) mainTitle.value = websiteData.businessName;
if (subtitle) subtitle.value = websiteData.subtitle;
if (primaryColor) primaryColor.value = websiteData.primaryColor;
if (secondaryColor) secondaryColor.value = websiteData.secondaryColor;

createPageNavigation();
showPage('accueil');

showNotification('‚úÖ Pr√©visualisation charg√©e ! Naviguez entre les pages.');
}

function createPageNavigation() {
const pageNav = document.getElementById('pageNavigation');
if (!pageNav) return;

const pageNames = {
'accueil': 'üè† Accueil',
'apropos': 'üë• √Ä propos',
'services': '‚öôÔ∏è Services',
'portfolio': 'üé® Portfolio',
'equipe': 'üë®\u200düíº √âquipe',
'temoignages': 'üí¨ T√©moignages',
'blog': 'üìù Blog',
'contact': 'üìû Contact'
};

pageNav.innerHTML = '';
websiteData.selectedPages.forEach(page => {
const tab = document.createElement('div');
tab.className = `page-tab ${page === 'accueil' ? 'active' : ''}`;
tab.textContent = pageNames[page] || page;
tab.onclick = () => showPage(page);
pageNav.appendChild(tab);
});
}

function showPage(page) {
currentPage = page;

// Mettre √† jour les onglets
document.querySelectorAll('.page-tab').forEach(tab => {
tab.classList.remove('active');
});
const activeTab = [...document.querySelectorAll('.page-tab')][websiteData.selectedPages.indexOf(page)];
if (activeTab) {
activeTab.classList.add('active');
}

// Afficher le contenu
const previewEl = document.getElementById('websitePreview');
if (previewEl && generatedPages[page]) {
previewEl.innerHTML = generatedPages[page];
} else {
previewEl.innerHTML = '<div style="padding: 50px; text-align: center; color: #6b7280;"><p>Page en cours de g√©n√©ration...</p></div>';
}
}

function updatePreview() {
console.log('üîÑ Mise √† jour pr√©visualisation...');
const primaryColor = document.getElementById('primaryColor').value;
const secondaryColor = document.getElementById('secondaryColor').value;
const mainTitle = document.getElementById('mainTitle').value;
const subtitle = document.getElementById('subtitle').value;

// Mettre √† jour les donn√©es
websiteData.primaryColor = primaryColor;
websiteData.secondaryColor = secondaryColor;
websiteData.mainTitle = mainTitle;
websiteData.subtitle = subtitle;

// Reg√©n√©rer la page actuelle
generatedPages[currentPage] = generatePageContent(currentPage);
showPage(currentPage);

showNotification('‚úÖ Aper√ßu mis √† jour !');
}

// ========== G√âN√âRATION DE CONTENU ==========
function generatePageContent(page) {
const template = allTemplates[selectedTemplate];
const { businessName, siteType, description, phone, address, photos, primaryColor, secondaryColor, slogan, teamInfo, servicesDetail, socialMedia } = websiteData;

let content = '';

// En-t√™te commun
content += generatePageHeader();

switch(page) {
case 'accueil':
content += generateAccueilContent();
break;
case 'apropos':
content += generateAproposContent();
break;
case 'services':
content += generateServicesContent();
break;
case 'portfolio':
content += generatePortfolioContent();
break;
case 'equipe':
content += generateEquipeContent();
break;
case 'temoignages':
content += generateTemoignagesContent();
break;
case 'blog':
content += generateBlogContent();
break;
case 'contact':
content += generateContactContent();
break;
}

content += generatePageFooter();
return content;
}

function generatePageHeader() {
const { businessName, primaryColor, secondaryColor } = websiteData;
return `
<header style="background: linear-gradient(135deg, ${primaryColor}, ${secondaryColor}); color: white; padding: 20px 0;">
<div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
<h1 style="font-size: 1.8rem; font-weight: bold; margin: 0;" class="editable-title">${businessName}</h1>
<nav style="display: flex; gap: 20px; flex-wrap: wrap;">
${websiteData.selectedPages.map(page => {
const pageNames = {
'accueil': 'Accueil',
'apropos': '√Ä propos', 
'services': 'Services',
'portfolio': 'Portfolio',
'equipe': '√âquipe',
'temoignages': 'T√©moignages',
'blog': 'Blog',
'contact': 'Contact'
};
return `<a href="#${page}" style="color: white; text-decoration: none; opacity: 0.9; font-weight: 500;" class="editable-nav">${pageNames[page]}</a>`;
}).join('')}
</nav>
</div>
</div>
</header>
`;
}

function generateAccueilContent() {
const { businessName, description, slogan, photos, primaryColor } = websiteData;
const mainImage = photos.length > 0 ? photos[0].dataURL : 'https://images.unsplash.com/photo-1497366216548-37526070297c?w=800&h=600&fit=crop';

return `
<main style="padding: 0;">
<!-- Hero Section -->
<section style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${mainImage}'); background-size: cover; background-position: center; color: white; padding: 100px 20px; text-align: center;">
<div style="max-width: 800px; margin: 0 auto;">
<h2 style="font-size: 3rem; font-weight: bold; margin-bottom: 20px; line-height: 1.2;">${businessName}</h2>
<p style="font-size: 1.3rem; margin-bottom: 30px; opacity: 0.9;">${slogan || description}</p>
<button style="background: ${primaryColor}; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transform: translateY(0); transition: all 0.3s;">
D√©couvrir nos services
</button>
</div>
</section>

<!-- Services Section -->
<section style="padding: 80px 20px; background: #f8fafc;">
<div style="max-width: 1200px; margin: 0 auto; text-align: center;">
<h3 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 20px; color: #1f2937;">Nos Services</h3>
<p style="font-size: 1.1rem; color: #6b7280; margin-bottom: 50px;">${description}</p>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
${generateServiceCards()}
</div>
</div>
</section>

<!-- CTA Section -->
<section style="padding: 80px 20px; background: ${primaryColor}; color: white; text-align: center;">
<div style="max-width: 800px; margin: 0 auto;">
<h3 style="font-size: 2.2rem; font-weight: bold; margin-bottom: 20px;">Pr√™t √† commencer ?</h3>
<p style="font-size: 1.1rem; margin-bottom: 30px; opacity: 0.9;">Contactez-nous d√®s aujourd'hui pour discuter de votre projet</p>
<button style="background: white; color: ${primaryColor}; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer;">
Nous contacter
</button>
</div>
</section>
</main>
`;
}

function generateServiceCards() {
const services = getServicesByType(websiteData.siteType);
return services.map(service => `
<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
<div style="font-size: 3rem; margin-bottom: 20px;">${service.icon}</div>
<h4 style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #1f2937;">${service.title}</h4>
<p style="color: #6b7280; line-height: 1.6;">${service.description}</p>
</div>
`).join('');
}

function getServicesByType(siteType) {
const serviceTypes = {
restaurant: [
{ icon: 'üçΩÔ∏è', title: 'Cuisine Gastronomique', description: 'Des plats pr√©par√©s avec des ingr√©dients frais et de qualit√©' },
{ icon: 'üç∑', title: 'Cave √† Vins', description: 'Une s√©lection exceptionnelle de vins pour accompagner vos repas' },
{ icon: 'üë®\u200düç≥', title: 'Chef Exp√©riment√©', description: 'Une √©quipe de cuisiniers passionn√©s et talentueux' }
],
salon: [
{ icon: 'üíá\u200d‚ôÄÔ∏è', title: 'Coiffure', description: 'Coupes, colorations et soins capillaires personnalis√©s' },
{ icon: 'üíÖ', title: 'Manucure', description: 'Soins des ongles et nail art professionnel' },
{ icon: '‚ú®', title: 'Soins Esth√©tiques', description: 'Soins du visage et √©pilations dans un cadre relaxant' }
],
default: [
{ icon: '‚≠ê', title: 'Excellence', description: 'Un service de qualit√© sup√©rieure adapt√© √† vos besoins' },
{ icon: 'üéØ', title: 'Sur Mesure', description: 'Des solutions personnalis√©es pour chaque client' },
{ icon: 'üìû', title: 'Support', description: 'Un accompagnement complet et un suivi personnalis√©' }
]
};
return serviceTypes[siteType] || serviceTypes.default;
}

function generateAproposContent() {
const { businessName, description, teamInfo } = websiteData;
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1000px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 30px; color: #1f2937;">√Ä propos de ${businessName}</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 50px; align-items: center; margin-bottom: 50px;">
<div>
<p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563; margin-bottom: 25px;">${description}</p>
<p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563;">${teamInfo || 'Notre √©quipe est compos√©e de professionnels exp√©riment√©s, passionn√©s par leur m√©tier et d√©di√©s √† la satisfaction de nos clients.'}</p>
</div>
<div style="text-align: center;">
<div style="width: 300px; height: 200px; background: linear-gradient(135deg, ${websiteData.primaryColor}, ${websiteData.secondaryColor}); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; margin: 0 auto;">
Image de l'√©quipe
</div>
</div>
</div>
</div>
</main>
`;
}

function generateServicesContent() {
const { servicesDetail } = websiteData;
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1200px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">Nos Services</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
${generateServiceCards()}
</div>
${servicesDetail ? `
<div style="background: #f8fafc; padding: 40px; border-radius: 10px; margin-top: 50px;">
<h3 style="font-size: 1.8rem; font-weight: bold; margin-bottom: 20px; color: #1f2937;">D√©tails de nos Services</h3>
<p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563;">${servicesDetail}</p>
</div>
` : ''}
</div>
</main>
`;
}

function generatePortfolioContent() {
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1200px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">Portfolio</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
${Array(6).fill().map((_, i) => `
<div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
<div style="width: 100%; height: 200px; background: linear-gradient(45deg, ${websiteData.primaryColor}, ${websiteData.secondaryColor}); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.1rem;">
Projet ${i + 1}
</div>
<div style="padding: 20px;">
<h4 style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #1f2937;">R√©alisation ${i + 1}</h4>
<p style="color: #6b7280; line-height: 1.6;">Description du projet r√©alis√© avec succ√®s pour notre client.</p>
</div>
</div>
`).join('')}
</div>
</div>
</main>
`;
}

function generateEquipeContent() {
const { teamInfo } = websiteData;
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1000px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">Notre √âquipe</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 50px;">
${Array(3).fill().map((_, i) => `
<div style="text-align: center; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
<div style="width: 120px; height: 120px; background: linear-gradient(135deg, ${websiteData.primaryColor}, ${websiteData.secondaryColor}); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
üë§
</div>
<h4 style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px; color: #1f2937;">Membre ${i + 1}</h4>
<p style="color: #6b7280; margin-bottom: 15px;">Poste / Sp√©cialit√©</p>
<p style="color: #4b5563; font-size: 0.9rem; line-height: 1.6;">Expert dans son domaine avec plusieurs ann√©es d'exp√©rience.</p>
</div>
`).join('')}
</div>
${teamInfo ? `
<div style="background: #f8fafc; padding: 40px; border-radius: 10px; text-align: center;">
<p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563;">${teamInfo}</p>
</div>
` : ''}
</div>
</main>
`;
}

function generateTemoignagesContent() {
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1000px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">T√©moignages Clients</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
${Array(4).fill().map((_, i) => `
<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative;">
<div style="font-size: 3rem; color: ${websiteData.primaryColor}; margin-bottom: 15px;">"</div>
<p style="color: #4b5563; line-height: 1.7; margin-bottom: 20px; font-style: italic;">Excellent service, je recommande vivement ! L'√©quipe est professionnelle et √† l'√©coute.</p>
<div style="display: flex; align-items: center; gap: 15px;">
<div style="width: 50px; height: 50px; background: linear-gradient(135deg, ${websiteData.primaryColor}, ${websiteData.secondaryColor}); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
${String.fromCharCode(65 + i)}
</div>
<div>
<h5 style="font-weight: bold; color: #1f2937; margin-bottom: 5px;">Client ${i + 1}</h5>
<div style="display: flex; color: #fbbf24;">
${'‚òÖ'.repeat(5)}
</div>
</div>
</div>
</div>
`).join('')}
</div>
</div>
</main>
`;
}

function generateBlogContent() {
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1000px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">Blog & Actualit√©s</h2>
<div style="display: grid; gap: 40px;">
${Array(3).fill().map((_, i) => `
<article style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: grid; grid-template-columns: 300px 1fr; gap: 30px;">
<div style="width: 300px; height: 200px; background: linear-gradient(45deg, ${websiteData.primaryColor}, ${websiteData.secondaryColor}); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.1rem;">
Image Article ${i + 1}
</div>
<div style="padding: 30px;">
<h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; color: #1f2937;">Titre de l'article ${i + 1}</h3>
<p style="color: #6b7280; line-height: 1.7; margin-bottom: 20px;">D√©couvrez nos derni√®res actualit√©s et conseils d'experts dans notre domaine. Restez inform√© des tendances et innovations...</p>
<div style="display: flex; justify-between; align-items: center;">
<span style="color: #9ca3af; font-size: 0.9rem;">Publi√© le ${new Date().toLocaleDateString()}</span>
<a href="#" style="color: ${websiteData.primaryColor}; text-decoration: none; font-weight: 600;">Lire la suite ‚Üí</a>
</div>
</div>
</article>
`).join('')}
</div>
</div>
</main>
`;
}

function generateContactContent() {
const { businessName, phone, address, userEmail, socialMedia } = websiteData;
return `
<main style="padding: 60px 20px;">
<div style="max-width: 1000px; margin: 0 auto;">
<h2 style="font-size: 2.5rem; font-weight: bold; text-align: center; margin-bottom: 50px; color: #1f2937;">Nous Contacter</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 50px;">
<!-- Informations de contact -->
<div>
<h3 style="font-size: 1.8rem; font-weight: bold; margin-bottom: 30px; color: #1f2937;">Nos Coordonn√©es</h3>
<div style="space-y: 20px;">
${address ? `
<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
<div style="width: 50px; height: 50px; background: ${websiteData.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
üìç
</div>
<div>
<h4 style="font-weight: bold; color: #1f2937;">Adresse</h4>
<p style="color: #6b7280;">${address}</p>
</div>
</div>
` : ''}
${phone ? `
<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
<div style="width: 50px; height: 50px; background: ${websiteData.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
üìû
</div>
<div>
<h4 style="font-weight: bold; color: #1f2937;">T√©l√©phone</h4>
<p style="color: #6b7280;">${phone}</p>
</div>
</div>
` : ''}
<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
<div style="width: 50px; height: 50px; background: ${websiteData.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
‚úâÔ∏è
</div>
<div>
<h4 style="font-weight: bold; color: #1f2937;">Email</h4>
<p style="color: #6b7280;">${userEmail}</p>
</div>
</div>
</div>

${Object.values(socialMedia).some(url => url) ? `
<div style="margin-top: 30px;">
<h4 style="font-weight: bold; color: #1f2937; margin-bottom: 15px;">Suivez-nous</h4>
<div style="display: flex; gap: 15px;">
${socialMedia.facebook ? `<a href="${socialMedia.facebook}" style="color: ${websiteData.primaryColor}; font-size: 1.5rem;">üìò</a>` : ''}
${socialMedia.instagram ? `<a href="${socialMedia.instagram}" style="color: ${websiteData.primaryColor}; font-size: 1.5rem;">üì∑</a>` : ''}
${socialMedia.linkedin ? `<a href="${socialMedia.linkedin}" style="color: ${websiteData.primaryColor}; font-size: 1.5rem;">üíº</a>` : ''}
${socialMedia.twitter ? `<a href="${socialMedia.twitter}" style="color: ${websiteData.primaryColor}; font-size: 1.5rem;">üê¶</a>` : ''}
</div>
</div>
` : ''}
</div>

<!-- Formulaire de contact -->
<div>
<h3 style="font-size: 1.8rem; font-weight: bold; margin-bottom: 30px; color: #1f2937;">Envoyez-nous un message</h3>
<form style="display: flex; flex-direction: column; gap: 20px;">
<input type="text" placeholder="Votre nom" style="padding: 15px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 1rem;">
<input type="email" placeholder="Votre email" style="padding: 15px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 1rem;">
<input type="text" placeholder="Sujet" style="padding: 15px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 1rem;">
<textarea placeholder="Votre message" rows="5" style="padding: 15px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 1rem; resize: vertical;"></textarea>
<button type="submit" style="background: ${websiteData.primaryColor}; color: white; padding: 15px; border: none; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer;">
Envoyer le message
</button>
</form>
</div>
</div>
</div>
</main>
`;
}

function generatePageFooter() {
const { businessName, userEmail, phone, socialMedia } = websiteData;
return `
<footer style="background: #1f2937; color: white; padding: 50px 20px 20px;">
<div style="max-width: 1200px; margin: 0 auto;">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 30px;">
<div>
<h3 style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px;">${businessName}</h3>
<p style="color: #9ca3af; line-height: 1.6;">Merci de votre confiance. Nous sommes √† votre service pour tous vos besoins.</p>
</div>
<div>
<h4 style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Contact</h4>
${userEmail ? `<p style="color: #9ca3af; margin-bottom: 8px;">üìß ${userEmail}</p>` : ''}
${phone ? `<p style="color: #9ca3af; margin-bottom: 8px;">üìû ${phone}</p>` : ''}
</div>
<div>
<h4 style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Navigation</h4>
<div style="display: flex; flex-direction: column; gap: 8px;">
${websiteData.selectedPages.map(page => {
const pageNames = {
'accueil': 'Accueil', 'apropos': '√Ä propos', 'services': 'Services',
'portfolio': 'Portfolio', 'equipe': '√âquipe', 'temoignages': 'T√©moignages',
'blog': 'Blog', 'contact': 'Contact'
};
return `<a href="#${page}" style="color: #9ca3af; text-decoration: none;">${pageNames[page]}</a>`;
}).join('')}
</div>
</div>
</div>
<div style="border-top: 1px solid #374151; padding-top: 20px; text-align: center; color: #9ca3af;">
<p>&copy; ${new Date().getFullYear()} ${businessName}. Tous droits r√©serv√©s.</p>
</div>
</div>
</footer>
`;
}

// ========== FINALISATION ET ENVOI ==========
function finalizeAndSend() {
console.log('üéâ Finalisation du site...');

// Navigation vers la section email
document.getElementById('previewSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'block';
document.getElementById('mainSection').style.display = 'none';
document.getElementById('qualityTemplates').style.display = 'none';

// Mettre √† jour les infos finales
const finalPageCount = document.getElementById('finalPageCount');
if (finalPageCount) {
finalPageCount.textContent = `Site ${websiteData.selectedPages.length} pages complet`;
}

// Pr√©remplir l'email si disponible
const deliveryEmail = document.getElementById('deliveryEmail');
if (deliveryEmail && websiteData.userEmail) {
deliveryEmail.value = websiteData.userEmail;
}

window.scrollTo(0, 0);
showNotification('‚úÖ Pr√™t pour la livraison ! Confirmez votre email.');
}

function sendWebsiteEmail(event) {
event.preventDefault();
console.log('üìß Envoi du site par email...');

const deliveryEmail = document.getElementById('deliveryEmail').value.trim();
if (!deliveryEmail || !deliveryEmail.includes('@')) {
showNotification('‚ùå Veuillez saisir un email valide');
return;
}

// Afficher le loading
document.getElementById('finalEmailForm').style.display = 'none';
document.getElementById('loadingSpinner').style.display = 'block';
document.getElementById('successMessage').style.display = 'none';

// Simuler l'envoi (dans un vrai projet, ici on ferait l'appel API)
setTimeout(() => {
// Masquer le loading
document.getElementById('loadingSpinner').style.display = 'none';
document.getElementById('successMessage').style.display = 'block';

// Enregistrer dans localStorage pour le suivi
const sentWebsites = JSON.parse(localStorage.getItem('sentWebsites') || '[]');
sentWebsites.push({
businessName: websiteData.businessName,
email: deliveryEmail,
pages: websiteData.selectedPages,
template: allTemplates[selectedTemplate].name,
dateSent: new Date().toISOString(),
websiteData: websiteData
});
localStorage.setItem('sentWebsites', JSON.stringify(sentWebsites));

showNotification(`‚úÖ Site envoy√© √† ${deliveryEmail} avec succ√®s !`);
console.log('‚úÖ Site livr√© avec succ√®s');
}, 3000);
}

function createNewSite() {
// R√©initialiser toutes les variables
websiteData = {};
selectedTemplate = null;
uploadedPhotos = [];
currentPage = 'accueil';
generatedPages = {};

// R√©initialiser le formulaire
document.getElementById('websiteForm').reset();
document.getElementById('photoPreview').innerHTML = '';
document.getElementById('photoPreview').classList.add('hidden');

// Navigation vers le d√©but
document.getElementById('mainSection').style.display = 'block';
document.getElementById('qualityTemplates').style.display = 'none';
document.getElementById('previewSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'none';

window.scrollTo(0, 0);
showNotification('üöÄ Pr√™t pour un nouveau site !');
}

// ========== NAVIGATION ==========
function goBackToMain() {
document.getElementById('mainSection').style.display = 'block';
document.getElementById('qualityTemplates').style.display = 'none';
document.getElementById('previewSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'none';
window.scrollTo(0, 0);
}

function goBackToTemplates() {
document.getElementById('qualityTemplates').style.display = 'block';
document.getElementById('previewSection').style.display = 'none';
document.getElementById('mainSection').style.display = 'none';
document.getElementById('emailSection').style.display = 'none';
window.scrollTo(0, 0);
}

// ========== UPLOAD PHOTOS ==========
function setupPhotoUpload() {
const photoInput = document.getElementById('photoInput');
const photoUploadArea = document.getElementById('photoUploadArea');
const photoPreview = document.getElementById('photoPreview');

if (!photoInput || !photoUploadArea) return;

photoInput.addEventListener('change', handlePhotoUpload);

// Drag & Drop
photoUploadArea.addEventListener('dragover', (e) => {
e.preventDefault();
photoUploadArea.classList.add('drag-over');
});

photoUploadArea.addEventListener('dragleave', () => {
photoUploadArea.classList.remove('drag-over');
});

photoUploadArea.addEventListener('drop', (e) => {
e.preventDefault();
photoUploadArea.classList.remove('drag-over');
const files = Array.from(e.dataTransfer.files);
processPhotos(files);
});
}

function handlePhotoUpload(event) {
const files = Array.from(event.target.files);
processPhotos(files);
}

function processPhotos(files) {
const validFiles = files.filter(file => {
const isValidType = file.type.startsWith('image/');
const isValidSize = file.size <= 5 * 1024 * 1024; // 5MB
return isValidType && isValidSize;
});

if (validFiles.length !== files.length) {
showNotification('‚ùå Certains fichiers ont √©t√© ignor√©s (type non valide ou trop volumineux)');
}

validFiles.forEach(file => {
const reader = new FileReader();
reader.onload = (e) => {
const photo = {
file: file,
dataURL: e.target.result,
name: file.name
};
uploadedPhotos.push(photo);
displayPhotoPreview();
};
reader.readAsDataURL(file);
});
}

function displayPhotoPreview() {
const photoPreview = document.getElementById('photoPreview');
if (!photoPreview) return;

if (uploadedPhotos.length === 0) {
photoPreview.classList.add('hidden');
return;
}

photoPreview.classList.remove('hidden');
photoPreview.innerHTML = uploadedPhotos.map((photo, index) => `
<div style="position: relative;">
<img src="${photo.dataURL}" alt="${photo.name}" style="width: 100%; height: 100px; object-fit: cover; border-radius: 5px;">
<button onclick="removePhoto(${index})" style="position: absolute; top: 5px; right: 5px; background: rgba(220, 38, 38, 0.8); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
√ó
</button>
</div>
`).join('');

showNotification(`‚úÖ ${uploadedPhotos.length} photo(s) ajout√©e(s)`);
}

function removePhoto(index) {
uploadedPhotos.splice(index, 1);
displayPhotoPreview();
showNotification('üóëÔ∏è Photo supprim√©e');
}

// ========== AUTHENTIFICATION ==========
function showLogin() {
document.getElementById('authModal').style.display = 'block';
document.getElementById('authModalTitle').textContent = 'Connexion';
document.getElementById('loginForm').style.display = 'block';
document.getElementById('registerForm').style.display = 'none';
}

function showRegister() {
document.getElementById('authModal').style.display = 'block';
document.getElementById('authModalTitle').textContent = 'Inscription';
document.getElementById('loginForm').style.display = 'none';
document.getElementById('registerForm').style.display = 'block';
}

function showLoginForm() {
document.getElementById('authModalTitle').textContent = 'Connexion';
document.getElementById('loginForm').style.display = 'block';
document.getElementById('registerForm').style.display = 'none';
}

function showRegisterForm() {
document.getElementById('authModalTitle').textContent = 'Inscription';
document.getElementById('loginForm').style.display = 'none';
document.getElementById('registerForm').style.display = 'block';
}

function closeAuthModal() {
document.getElementById('authModal').style.display = 'none';
}

function login(event) {
event.preventDefault();
const email = document.getElementById('loginEmail').value;
const password = document.getElementById('loginPassword').value;

// Simulation de connexion
const users = JSON.parse(localStorage.getItem('users') || '[]');
const user = users.find(u => u.email === email && u.password === password);

if (user) {
currentUser = user;
localStorage.setItem('currentUser', JSON.stringify(currentUser));
showUserMenu();
closeAuthModal();
showNotification(`‚úÖ Connexion r√©ussie, bienvenue ${user.name} !`);
} else {
showNotification('‚ùå Email ou mot de passe incorrect');
}
}

function register(event) {
event.preventDefault();
const name = document.getElementById('registerName').value;
const email = document.getElementById('registerEmail').value;
const password = document.getElementById('registerPassword').value;

const users = JSON.parse(localStorage.getItem('users') || '[]');

if (users.find(u => u.email === email)) {
showNotification('‚ùå Cet email est d√©j√† utilis√©');
return;
}

const newUser = { name, email, password, id: Date.now() };
users.push(newUser);
localStorage.setItem('users', JSON.stringify(users));

currentUser = newUser;
localStorage.setItem('currentUser', JSON.stringify(currentUser));
showUserMenu();
closeAuthModal();
showNotification(`‚úÖ Inscription r√©ussie, bienvenue ${name} !`);
}

function showUserMenu() {
document.getElementById('authButtons').style.display = 'none';
document.getElementById('userMenu').style.display = 'block';
document.getElementById('userName').textContent = `Bonjour, ${currentUser.name}`;
}

function logout() {
currentUser = null;
localStorage.removeItem('currentUser');
document.getElementById('authButtons').style.display = 'flex';
document.getElementById('userMenu').style.display = 'none';
showNotification('üëã D√©connexion r√©ussie');
}

// ========== PARTAGE ==========
function toggleShareMenu() {
const shareMenu = document.getElementById('shareMenu');
shareMenu.classList.toggle('hidden');
}

function shareOnFacebook() {
const url = encodeURIComponent(window.location.href);
window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnTwitter() {
const url = encodeURIComponent(window.location.href);
const text = encodeURIComponent('Cr√©ez votre site web professionnel avec IA WebGen Pro !');
window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareOnWhatsApp() {
const url = encodeURIComponent(window.location.href);
const text = encodeURIComponent('D√©couvrez IA WebGen Pro pour cr√©er votre site web professionnel !');
window.open(`https://wa.me/?text=${text} ${url}`, '_blank');
}

function copyLink() {
navigator.clipboard.writeText(window.location.href).then(() => {
showNotification('‚úÖ Lien copi√© dans le presse-papier !');
});
}

// ========== NOTIFICATIONS ==========
function showNotification(message) {
const notification = document.getElementById('notification');
const text = document.getElementById('notificationText');
if (notification && text) {
text.textContent = message;
notification.style.display = 'block';
setTimeout(() => {
notification.style.display = 'none';
}, 5000);
}
console.log('üì¢', message);
}

// ========== FERMETURE MODALES ==========
window.onclick = function(event) {
const authModal = document.getElementById('authModal');
if (event.target === authModal) {
closeAuthModal();
}
}

// ========== MODE √âDITION ==========
function toggleEditMode() {
editMode = !editMode;
const previewEl = document.getElementById('websitePreview');
const editModeBtn = document.getElementById('editModeBtn');
const editModeStatus = document.getElementById('editModeStatus');

if (editMode) {
previewEl.classList.add('edit-mode');
editModeStatus.textContent = 'Activ√©';
editModeBtn.classList.remove('bg-purple-500');
editModeBtn.classList.add('bg-orange-500');
makeElementsEditable();
showNotification('‚úèÔ∏è Mode √©dition activ√© ! Cliquez sur les √©l√©ments pour les modifier.');
} else {
previewEl.classList.remove('edit-mode');
editModeStatus.textContent = 'D√©sactiv√©';
editModeBtn.classList.remove('bg-orange-500');
editModeBtn.classList.add('bg-purple-500');
removeEditableElements();
showNotification('‚úÖ Mode √©dition d√©sactiv√©.');
}
}

function makeElementsEditable() {
const previewEl = document.getElementById('websitePreview');
if (!previewEl) return;

console.log('Activation des √©l√©ments √©ditables');

// Supprimer les anciens event listeners pour √©viter les doublons
removeEditableElements();

// S√©lectionner tous les √©l√©ments √©ditables avec des s√©lecteurs plus pr√©cis
const editableSelectors = [
'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
'p', 'span', 'div[data-editable="text"]',
'a:not(nav a)', 'button',
'img', '[data-editable="image"]',
'[data-editable="button"]'
].join(', ');

const elements = previewEl.querySelectorAll(editableSelectors);
let editableCount = 0;

elements.forEach(element => {
// V√©rifier si l'√©l√©ment a du contenu ou est une image
const hasTextContent = element.textContent && element.textContent.trim().length > 0;
const isImage = element.tagName === 'IMG' || element.hasAttribute('data-editable');
const isButton = element.tagName === 'BUTTON' || element.hasAttribute('data-editable');

if (hasTextContent || isImage || isButton) {
// √âviter les √©l√©ments imbriqu√©s (prendre le parent le plus proche)
let isNested = false;
let parent = element.parentElement;
while (parent && parent !== previewEl) {
if (parent.classList.contains('editable')) {
isNested = true;
break;
}
parent = parent.parentElement;
}

if (!isNested && !element.classList.contains('edit-toolbar')) {
element.classList.add('editable');
element.addEventListener('click', handleElementClick, true);
editableCount++;

// Ajouter un attribut pour identifier le type
if (element.tagName === 'IMG') {
element.setAttribute('data-edit-type', 'image');
} else if (element.tagName === 'BUTTON' || element.getAttribute('data-editable') === 'button') {
element.setAttribute('data-edit-type', 'button');
} else {
element.setAttribute('data-edit-type', 'text');
}
}
}
});

console.log(`${editableCount} √©l√©ments rendus √©ditables`);
showNotification(`‚úÖ ${editableCount} √©l√©ments √©ditables activ√©s`);
}

function removeEditableElements() {
const editableElements = document.querySelectorAll('.editable');
editableElements.forEach(element => {
element.classList.remove('editable');
element.removeEventListener('click', handleElementClick);
});

// Supprimer les barres d'outils existantes
const toolbars = document.querySelectorAll('.edit-toolbar');
toolbars.forEach(toolbar => toolbar.remove());
}

function handleElementClick(event) {
if (!editMode) return;
event.preventDefault();
event.stopPropagation();

console.log('√âl√©ment cliqu√©:', event.target);

// Supprimer les barres d'outils existantes
const existingToolbars = document.querySelectorAll('.edit-toolbar');
existingToolbars.forEach(toolbar => toolbar.remove());

const element = event.target;
showEditToolbar(element);
}

function showEditToolbar(element) {
console.log('Affichage de la barre d\'outils pour:', element);

// Assigner un ID unique si n√©cessaire
if (!element.id) {
element.id = 'editable-' + Date.now();
}

// D√©terminer le type d'√©l√©ment
const editType = element.getAttribute('data-edit-type') || 'text';
const isImage = editType === 'image' || element.tagName === 'IMG';
const isButton = editType === 'button' || element.tagName === 'BUTTON';

// Cr√©er la barre d'outils
const toolbar = document.createElement('div');
toolbar.className = 'edit-toolbar';
toolbar.style.position = 'absolute';
toolbar.style.top = '-45px';
toolbar.style.left = '0';
toolbar.style.background = '#1f2937';
toolbar.style.borderRadius = '6px';
toolbar.style.padding = '8px';
toolbar.style.display = 'flex';
toolbar.style.gap = '5px';
toolbar.style.zIndex = '1001';
toolbar.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
toolbar.style.whiteSpace = 'nowrap';

let toolbarHTML = '';

if (isImage) {
toolbarHTML = `
<button class="edit-btn" onclick="replaceImage('${element.id}')" style="background: #10b981; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-image"></i> Changer
</button>
<button class="edit-btn" onclick="editImageStyle('${element.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-palette"></i> Style
</button>
<button class="edit-btn" onclick="deleteElement('${element.id}')" style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-trash"></i> Suppr
</button>
`;
} else if (isButton) {
toolbarHTML = `
<button class="edit-btn" onclick="editText('${element.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-edit"></i> Texte
</button>
<button class="edit-btn" onclick="editButtonLink('${element.id}')" style="background: #8b5cf6; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-link"></i> Lien
</button>
<button class="edit-btn" onclick="editStyle('${element.id}')" style="background: #f59e0b; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-palette"></i> Style
</button>
<button class="edit-btn" onclick="deleteElement('${element.id}')" style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-trash"></i> Suppr
</button>
`;
} else {
toolbarHTML = `
<button class="edit-btn" onclick="editText('${element.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-edit"></i> Texte
</button>
<button class="edit-btn" onclick="editStyle('${element.id}')" style="background: #f59e0b; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-palette"></i> Style
</button>
<button class="edit-btn" onclick="deleteElement('${element.id}')" style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
<i class="fas fa-trash"></i> Suppr
</button>
`;
}

toolbar.innerHTML = toolbarHTML;

// Positionner l'√©l√©ment en relatif pour la barre d'outils
element.style.position = 'relative';
element.appendChild(toolbar);

console.log('Barre d\'outils ajout√©e pour:', element.id);
}

function replaceImage(elementId) {
const element = document.getElementById(elementId);
if (!element) return;

addChatMessage('Pour remplacer cette image, utilise la commande <b>/image [description]</b> dans le chat et s√©lectionne "Remplacer une image existante".', 'bot');

// Ouvrir le ChatGPT s'il est ferm√©
if (!chatGPTOpen) {
toggleChatGPT();
}

// Mettre l'√©l√©ment en surbrillance
element.style.border = '3px solid #10b981';
element.style.animation = 'pulse-green 2s infinite';

setTimeout(() => {
element.style.border = '';
element.style.animation = '';
}, 5000);
}

function editImageStyle(elementId) {
const element = document.getElementById(elementId);
if (!element) return;

const modal = document.createElement('div');
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-md">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Style de l'image</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Largeur maximale</label>
<select id="imageWidth" class="w-full p-3 border rounded">
<option value="200px">Petite (200px)</option>
<option value="400px">Moyenne (400px)</option>
<option value="600px">Grande (600px)</option>
<option value="100%">Pleine largeur</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Bordure</label>
<select id="imageBorder" class="w-full p-3 border rounded">
<option value="none">Aucune</option>
<option value="2px solid #e5e7eb">Fine grise</option>
<option value="4px solid #3b82f6">Bleue</option>
<option value="4px solid #10b981">Verte</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Arrondi des coins</label>
<select id="imageBorderRadius" class="w-full p-3 border rounded">
<option value="0">Carr√©</option>
<option value="8px">L√©g√®rement arrondi</option>
<option value="12px">Arrondi</option>
<option value="50%">Cercle</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Ombre</label>
<select id="imageShadow" class="w-full p-3 border rounded">
<option value="none">Aucune</option>
<option value="0 2px 8px rgba(0,0,0,0.1)">L√©g√®re</option>
<option value="0 4px 12px rgba(0,0,0,0.15)">Moyenne</option>
<option value="0 8px 25px rgba(0,0,0,0.2)">Forte</option>
</select>
</div>
<button onclick="applyImageStyle('${elementId}'); this.closest('.modal').remove();" 
        class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
<i class="fas fa-paint-brush mr-2"></i>Appliquer le style
</button>
</div>
</div>
`;
document.body.appendChild(modal);
}

function applyImageStyle(elementId) {
const element = document.getElementById(elementId);
const width = document.getElementById('imageWidth')?.value;
const border = document.getElementById('imageBorder')?.value;
const borderRadius = document.getElementById('imageBorderRadius')?.value;
const shadow = document.getElementById('imageShadow')?.value;

if (element) {
if (width) element.style.maxWidth = width;
if (border && border !== 'none') element.style.border = border;
if (borderRadius) element.style.borderRadius = borderRadius;
if (shadow && shadow !== 'none') element.style.boxShadow = shadow;

updateCurrentPageData();
showNotification('‚úÖ Style d\'image appliqu√© !');
}
}

function editButtonLink(elementId) {
const element = document.getElementById(elementId);
if (!element) return;

const currentHref = element.href || element.getAttribute('href') || '#';
const newHref = prompt('Nouvelle URL du lien:', currentHref);

if (newHref !== null) {
if (element.tagName === 'A') {
element.href = newHref;
} else {
element.setAttribute('href', newHref);
element.style.cursor = 'pointer';
element.onclick = () => window.open(newHref, '_blank');
}
updateCurrentPageData();
showNotification('‚úÖ Lien du bouton modifi√© !');
}
}

function editText(element) {
console.log('√âdition du texte pour:', element);
const currentText = element.textContent || element.innerText;

// Cr√©er un modal d'√©dition plus robuste
const modal = document.createElement('div');
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-lg">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Modifier le texte</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Nouveau texte :</label>
<textarea id="newTextContent" class="w-full p-3 border rounded-lg h-32" style="font-family: inherit;">${currentText}</textarea>
</div>
<div class="flex gap-3">
<button onclick="applyTextChange('${element.id || 'temp-' + Date.now()}'); this.closest('.modal').remove();" 
        class="flex-1 bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
<i class="fas fa-save mr-2"></i>Sauvegarder
</button>
<button onclick="this.closest('.modal').remove();" 
        class="flex-1 bg-gray-500 text-white py-3 rounded hover:bg-gray-600">
Annuler
</button>
</div>
</div>
</div>
`;

// Assigner un ID si n√©cessaire
if (!element.id) {
element.id = 'editable-' + Date.now();
}

document.body.appendChild(modal);

// Focus sur le textarea
setTimeout(() => {
const textarea = document.getElementById('newTextContent');
if (textarea) {
textarea.focus();
textarea.select();
}
}, 100);
}

function applyTextChange(elementId) {
const element = document.getElementById(elementId);
const newText = document.getElementById('newTextContent')?.value;

if (element && newText !== null) {
element.textContent = newText;
updateCurrentPageData();
showNotification('‚úÖ Texte modifi√© !');
console.log('Texte modifi√©:', elementId, newText);
} else {
showNotification('‚ùå Erreur lors de la modification');
}
}

function editStyle(element) {
const modal = document.createElement('div');
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-md">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Modifier le Style</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Couleur du texte</label>
<input type="color" id="textColor" class="w-full h-10 rounded" value="#000000">
</div>
<div>
<label class="block text-sm font-bold mb-2">Couleur de fond</label>
<input type="color" id="bgColor" class="w-full h-10 rounded" value="#ffffff">
</div>
<div>
<label class="block text-sm font-bold mb-2">Taille de police</label>
<select id="fontSize" class="w-full p-3 border rounded">
<option value="0.8rem">Petit</option>
<option value="1rem" selected>Normal</option>
<option value="1.2rem">Grand</option>
<option value="1.5rem">Tr√®s Grand</option>
<option value="2rem">√ânorme</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Alignement</label>
<select id="textAlign" class="w-full p-3 border rounded">
<option value="left">Gauche</option>
<option value="center">Centr√©</option>
<option value="right">Droite</option>
</select>
</div>
<button onclick="applyStyles('${element.id || 'temp-' + Date.now()}')" class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
Appliquer les styles
</button>
</div>
</div>
`;
document.body.appendChild(modal);

// Assigner un ID temporaire si n√©cessaire
if (!element.id) {
element.id = 'temp-' + Date.now();
}
}

function editStyle(element) {
console.log('√âdition du style pour:', element);

// Assigner un ID si n√©cessaire
if (!element.id) {
element.id = 'editable-' + Date.now();
}

const modal = document.createElement('div');
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-md">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Modifier le Style</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="space-y-4">
<div>
<label class="block text-sm font-bold mb-2">Couleur du texte</label>
<input type="color" id="textColor" class="w-full h-10 rounded" value="${rgbToHex(getComputedStyle(element).color) || '#000000'}">
</div>
<div>
<label class="block text-sm font-bold mb-2">Couleur de fond</label>
<input type="color" id="bgColor" class="w-full h-10 rounded" value="${rgbToHex(getComputedStyle(element).backgroundColor) || '#ffffff'}">
</div>
<div>
<label class="block text-sm font-bold mb-2">Taille de police</label>
<select id="fontSize" class="w-full p-3 border rounded">
<option value="0.8rem">Petit</option>
<option value="1rem" selected>Normal</option>
<option value="1.2rem">Grand</option>
<option value="1.5rem">Tr√®s Grand</option>
<option value="2rem">√ânorme</option>
<option value="2.5rem">Gigantesque</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Alignement</label>
<select id="textAlign" class="w-full p-3 border rounded">
<option value="left">Gauche</option>
<option value="center">Centr√©</option>
<option value="right">Droite</option>
<option value="justify">Justifi√©</option>
</select>
</div>
<div>
<label class="block text-sm font-bold mb-2">Espacement</label>
<select id="padding" class="w-full p-3 border rounded">
<option value="0">Aucun</option>
<option value="10px">Petit</option>
<option value="20px" selected>Normal</option>
<option value="30px">Grand</option>
<option value="40px">Tr√®s Grand</option>
</select>
</div>
<button onclick="applyStyleChanges('${element.id}'); this.closest('.modal').remove();" 
        class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
<i class="fas fa-paint-brush mr-2"></i>Appliquer les styles
</button>
</div>
</div>
`;
document.body.appendChild(modal);

// Pr√©-remplir les valeurs actuelles
setTimeout(() => {
const currentFontSize = getComputedStyle(element).fontSize;
const currentTextAlign = getComputedStyle(element).textAlign;
const currentPadding = getComputedStyle(element).padding.split(' ')[0];

const fontSizeSelect = document.getElementById('fontSize');
const textAlignSelect = document.getElementById('textAlign');
const paddingSelect = document.getElementById('padding');

if (fontSizeSelect) {
Array.from(fontSizeSelect.options).forEach(option => {
if (option.value === currentFontSize) option.selected = true;
});
}
if (textAlignSelect) textAlignSelect.value = currentTextAlign;
if (paddingSelect) {
Array.from(paddingSelect.options).forEach(option => {
if (option.value === currentPadding) option.selected = true;
});
}
}, 100);
}

function applyStyleChanges(elementId) {
const element = document.getElementById(elementId);
if (!element) {
showNotification('‚ùå √âl√©ment introuvable');
return;
}

const textColor = document.getElementById('textColor')?.value;
const bgColor = document.getElementById('bgColor')?.value;
const fontSize = document.getElementById('fontSize')?.value;
const textAlign = document.getElementById('textAlign')?.value;
const padding = document.getElementById('padding')?.value;

console.log('Application des styles:', {textColor, bgColor, fontSize, textAlign, padding});

// Appliquer les styles
if (textColor) element.style.color = textColor;
if (bgColor && bgColor !== '#ffffff') element.style.backgroundColor = bgColor;
if (fontSize) element.style.fontSize = fontSize;
if (textAlign) element.style.textAlign = textAlign;
if (padding) element.style.padding = padding;

// Sauvegarder
updateCurrentPageData();
showNotification('‚úÖ Styles appliqu√©s !');
console.log('Styles appliqu√©s √†:', elementId);
}

// Fonction utilitaire pour convertir RGB en HEX
function rgbToHex(rgb) {
if (!rgb || rgb === 'rgba(0, 0, 0, 0)' || rgb === 'transparent') return '#ffffff';

const result = rgb.match(/\d+/g);
if (!result) return '#000000';

const r = parseInt(result[0]);
const g = parseInt(result[1]);
const b = parseInt(result[2]);

return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
}

function deleteElement(elementId) {
const element = document.getElementById(elementId);
if (!element) return;

const elementType = element.tagName.toLowerCase();
const elementText = element.textContent?.substring(0, 50) || 'cet √©l√©ment';

if (confirm(`√ätes-vous s√ªr de vouloir supprimer ${elementType} "${elementText}..." ?`)) {
element.remove();
updateCurrentPageData();
showNotification('üóëÔ∏è √âl√©ment supprim√© !');
console.log('√âl√©ment supprim√©:', elementId);
}
}

function removeEditableElements() {
const editableElements = document.querySelectorAll('.editable');
editableElements.forEach(element => {
element.classList.remove('editable');
element.removeEventListener('click', handleElementClick, true);
element.removeAttribute('data-edit-type');
});

// Supprimer les barres d'outils existantes
const toolbars = document.querySelectorAll('.edit-toolbar');
toolbars.forEach(toolbar => toolbar.remove());

console.log('√âl√©ments √©ditables nettoy√©s');
}

function updateCurrentPageData() {
const previewEl = document.getElementById('websitePreview');
if (previewEl && currentPage && generatedPages) {
generatedPages[currentPage] = previewEl.innerHTML;
console.log('Donn√©es de la page mises √† jour:', currentPage);
}
}

// G√©rer l'envoi avec Entr√©e dans le ChatGPT
function setupChatGPTKeyHandlers() {
const chatInput = document.getElementById('chatgptInput');
if (chatInput) {
chatInput.addEventListener('keypress', function(e) {
if (e.key === 'Enter' && !e.shiftKey) {
e.preventDefault();
sendChatGPTMessage();
}
});
console.log('Handlers de clavier ChatGPT configur√©s');
}
}

// Correction de la fonction updatePreview pour les s√©lecteurs de couleurs
function updatePreview() {
console.log('üîÑ Mise √† jour pr√©visualisation...');
try {
const primaryColorEl = document.getElementById('primaryColor');
const secondaryColorEl = document.getElementById('secondaryColor');
const mainTitleEl = document.getElementById('mainTitle');
const subtitleEl = document.getElementById('subtitle');

if (!primaryColorEl || !secondaryColorEl || !mainTitleEl || !subtitleEl) {
console.error('√âl√©ments de contr√¥le introuvables');
return;
}

const primaryColor = primaryColorEl.value;
const secondaryColor = secondaryColorEl.value;
const mainTitle = mainTitleEl.value;
const subtitle = subtitleEl.value;

// Mettre √† jour les donn√©es globales
websiteData.primaryColor = primaryColor;
websiteData.secondaryColor = secondaryColor;
websiteData.mainTitle = mainTitle;
websiteData.subtitle = subtitle;

// Mettre √† jour tous les √©l√©ments qui utilisent ces couleurs
const previewEl = document.getElementById('websitePreview');
if (previewEl) {
// Mettre √† jour les couleurs primaires dans le contenu
const elementsWithPrimaryColor = previewEl.querySelectorAll('[style*="' + websiteData.primaryColor + '"]');
elementsWithPrimaryColor.forEach(el => {
const currentStyle = el.getAttribute('style') || '';
const newStyle = currentStyle.replace(new RegExp(websiteData.primaryColor.replace('#', '\\#'), 'g'), primaryColor);
el.setAttribute('style', newStyle);
});

// Mettre √† jour les titres
const titleElements = previewEl.querySelectorAll('h1, h2.editable-title');
titleElements.forEach(el => {
if (el.textContent.includes(websiteData.businessName)) {
el.textContent = mainTitle;
}
});
}

// Reg√©n√©rer la page actuelle avec les nouvelles donn√©es
if (currentPage) {
generatedPages[currentPage] = generatePageContent(currentPage);
showPage(currentPage);
}

showNotification('‚úÖ Aper√ßu mis √† jour !');
console.log('Pr√©visualisation mise √† jour avec:', {primaryColor, secondaryColor, mainTitle, subtitle});
} catch (error) {
console.error('Erreur lors de la mise √† jour:', error);
showNotification('‚ùå Erreur lors de la mise √† jour');
}
}
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-lg">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Ajouter une nouvelle section</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="space-y-4">
<div class="grid grid-cols-2 gap-4">
<button onclick="createNewSection('text'); this.closest('.modal').remove();" 
        class="bg-blue-500 text-white p-4 rounded hover:bg-blue-600 text-center">
<i class="fas fa-font text-2xl mb-2"></i><br>
<strong>Texte</strong><br>
<small>Paragraphe ou contenu</small>
</button>
<button onclick="createNewSection('title'); this.closest('.modal').remove();" 
        class="bg-green-500 text-white p-4 rounded hover:bg-green-600 text-center">
<i class="fas fa-heading text-2xl mb-2"></i><br>
<strong>Titre</strong><br>
<small>En-t√™te ou sous-titre</small>
</button>
<button onclick="createNewSection('image'); this.closest('.modal').remove();" 
        class="bg-purple-500 text-white p-4 rounded hover:bg-purple-600 text-center">
<i class="fas fa-image text-2xl mb-2"></i><br>
<strong>Image</strong><br>
<small>Photo ou illustration</small>
</button>
<button onclick="createNewSection('button'); this.closest('.modal').remove();" 
        class="bg-orange-500 text-white p-4 rounded hover:bg-orange-600 text-center">
<i class="fas fa-mouse-pointer text-2xl mb-2"></i><br>
<strong>Bouton</strong><br>
<small>Lien ou action</small>
</button>
<button onclick="createNewSection('cards'); this.closest('.modal').remove();" 
        class="bg-teal-500 text-white p-4 rounded hover:bg-teal-600 text-center">
<i class="fas fa-th-large text-2xl mb-2"></i><br>
<strong>Cartes</strong><br>
<small>Services ou produits</small>
</button>
<button onclick="createNewSection('contact'); this.closest('.modal').remove();" 
        class="bg-red-500 text-white p-4 rounded hover:bg-red-600 text-center">
<i class="fas fa-envelope text-2xl mb-2"></i><br>
<strong>Contact</strong><br>
<small>Formulaire ou infos</small>
</button>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
}

function createNewSection(type) {
console.log('Cr√©ation d\'une section:', type);
const previewEl = document.getElementById('websitePreview');
const mainContent = previewEl.querySelector('main') || previewEl;
const sectionId = 'section-' + Date.now();

let newElement = document.createElement('div');
newElement.className = 'editable new-section';
newElement.id = sectionId;
newElement.style.padding = '40px 20px';
newElement.style.margin = '20px 0';

switch(type) {
case 'text':
const textContent = prompt('Contenu du texte:') || 'Nouveau paragraphe de contenu. Vous pouvez modifier ce texte en cliquant dessus en mode √©dition.';
newElement.innerHTML = `
<div style="max-width: 800px; margin: 0 auto;">
<p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563;" data-editable="text">${textContent}</p>
</div>
`;
break;

case 'title':
const titleText = prompt('Texte du titre:') || 'Nouveau Titre';
newElement.innerHTML = `
<div style="text-align: center; margin-bottom: 30px;">
<h2 style="font-size: 2.5rem; font-weight: bold; color: ${websiteData.primaryColor}; margin-bottom: 15px;" data-editable="text">${titleText}</h2>
<div style="width: 80px; height: 4px; background: ${websiteData.primaryColor}; margin: 0 auto; border-radius: 2px;"></div>
</div>
`;
break;

case 'image':
newElement.innerHTML = `
<div style="text-align: center;">
<img src="https://via.placeholder.com/600x400/e5e7eb/6b7280?text=Nouvelle+Image" 
     alt="Nouvelle image" 
     style="width: 100%; max-width: 600px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);"
     data-editable="image">
<p style="margin-top: 15px; color: #6b7280; font-style: italic;" data-editable="text">Description de l'image</p>
</div>
`;
break;

case 'button':
const buttonText = prompt('Texte du bouton:') || 'Nouveau Bouton';
const buttonUrl = prompt('URL du lien (optionnel):') || '#';
newElement.innerHTML = `
<div style="text-align: center;">
<a href="${buttonUrl}" 
   style="display: inline-block; background: ${websiteData.primaryColor}; color: white; padding: 15px 40px; 
          border-radius: 8px; text-decoration: none; font-size: 1.1rem; font-weight: bold; 
          box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: all 0.3s ease;"
   data-editable="button">${buttonText}</a>
</div>
`;
break;

case 'cards':
newElement.innerHTML = `
<div style="max-width: 1200px; margin: 0 auto;">
<h3 style="text-align: center; font-size: 2rem; font-weight: bold; margin-bottom: 40px; color: #1f2937;" data-editable="text">Nos Services</h3>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
${[1,2,3].map(i => `
<div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;">
<div style="font-size: 3rem; margin-bottom: 20px;">‚≠ê</div>
<h4 style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #1f2937;" data-editable="text">Service ${i}</h4>
<p style="color: #6b7280; line-height: 1.6;" data-editable="text">Description du service ${i}. Cliquez pour modifier ce texte.</p>
</div>
`).join('')}
</div>
</div>
`;
break;

case 'contact':
newElement.innerHTML = `
<div style="max-width: 800px; margin: 0 auto; background: #f8fafc; padding: 40px; border-radius: 12px;">
<h3 style="text-align: center; font-size: 2rem; font-weight: bold; margin-bottom: 30px; color: #1f2937;" data-editable="text">Contactez-nous</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center;">
<div>
<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
<div style="width: 50px; height: 50px; background: ${websiteData.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">üìû</div>
<div>
<h4 style="font-weight: bold; color: #1f2937;">T√©l√©phone</h4>
<p style="color: #6b7280;" data-editable="text">+33 1 23 45 67 89</p>
</div>
</div>
<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
<div style="width: 50px; height: 50px; background: ${websiteData.primaryColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">‚úâÔ∏è</div>
<div>
<h4 style="font-weight: bold; color: #1f2937;">Email</h4>
<p style="color: #6b7280;" data-editable="text">contact@exemple.fr</p>
</div>
</div>
</div>
<div>
<div style="background: white; padding: 20px; border-radius: 8px;">
<h5 style="margin-bottom: 15px; font-weight: bold;">Formulaire de contact</h5>
<form style="display: flex; flex-direction: column; gap: 15px;">
<input type="text" placeholder="Votre nom" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 6px;">
<input type="email" placeholder="Votre email" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 6px;">
<textarea placeholder="Votre message" rows="4" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;"></textarea>
<button type="submit" style="background: ${websiteData.primaryColor}; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">Envoyer</button>
</form>
</div>
</div>
</div>
</div>
`;
break;
}

// Ajouter la nouvelle section
mainContent.appendChild(newElement);

// Actualiser les donn√©es et l'√©ditabilit√©
updateCurrentPageData();
if (editMode) {
makeElementsEditable();
}

showNotification(`‚úÖ Section "${type}" ajout√©e !`);
console.log('Section cr√©√©e:', type, sectionId);

// Scroller vers la nouvelle section
newElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function updateCurrentPageData() {
const previewEl = document.getElementById('websitePreview');
if (previewEl && currentPage) {
generatedPages[currentPage] = previewEl.innerHTML;
}
}

// ========== MINI CHATGPT ==========
function toggleChatGPT() {
const chatgpt = document.getElementById('miniChatGPT');
const toggle = document.getElementById('chatgptToggle');

chatGPTOpen = !chatGPTOpen;
if (chatGPTOpen) {
chatgpt.style.display = 'flex';
toggle.style.display = 'none';
} else {
chatgpt.style.display = 'none';
toggle.style.display = 'flex';
}
}

function closeChatGPT() {
chatGPTOpen = false;
document.getElementById('miniChatGPT').style.display = 'none';
document.getElementById('chatgptToggle').style.display = 'flex';
}

function toggleChatGPTSize() {
const chatgpt = document.getElementById('miniChatGPT');
const icon = document.getElementById('chatgptSizeIcon');

chatGPTMinimized = !chatGPTMinimized;
if (chatGPTMinimized) {
chatgpt.classList.add('minimized');
icon.className = 'fas fa-plus';
} else {
chatgpt.classList.remove('minimized');
icon.className = 'fas fa-minus';
}
}

function sendChatGPTMessage() {
const input = document.getElementById('chatgptInput');
const message = input.value.trim();
if (!message) return;

// Ajouter le message utilisateur
addChatMessage(message, 'user');
input.value = '';

// Traiter le message
setTimeout(() => {
processChatGPTMessage(message);
}, 1000);
}

function addChatMessage(message, sender) {
const messagesContainer = document.getElementById('chatgptMessages');
const messageEl = document.createElement('div');
messageEl.className = `message ${sender}`;

if (sender === 'user') {
messageEl.innerHTML = message;
} else {
messageEl.innerHTML = `<strong>ü§ñ Assistant IA</strong><br>${message}`;
}

messagesContainer.appendChild(messageEl);
messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function processChatGPTMessage(message) {
const lowerMessage = message.toLowerCase();

// Commande de recherche d'image
if (message.startsWith('/image ')) {
const query = message.substring(7);
searchImages(query);
return;
}

// R√©ponses contextuelles
let response = '';

if (lowerMessage.includes('aide') || lowerMessage.includes('help')) {
response = `Je peux t'aider avec :<br>
‚Ä¢ <b>/image [description]</b> - Chercher des images<br>
‚Ä¢ Questions sur l'√©dition du site<br>
‚Ä¢ Suggestions d'am√©lioration<br>
‚Ä¢ Conseils de design<br><br>
Que veux-tu faire ?`;
} else if (lowerMessage.includes('√©dition') || lowerMessage.includes('modifier')) {
response = `Pour modifier ton site :<br>
1. Active le <b>Mode √âdition</b> dans le panneau de droite<br>
2. Clique sur n'importe quel √©l√©ment pour le modifier<br>
3. Utilise les boutons d'√©dition qui apparaissent<br>
4. Tu peux changer les textes, couleurs, styles<br><br>
Veux-tu que j'active le mode √©dition pour toi ?`;
} else if (lowerMessage.includes('couleur') || lowerMessage.includes('color')) {
response = `Pour changer les couleurs :<br>
‚Ä¢ Utilise les s√©lecteurs de couleur √† droite<br>
‚Ä¢ En mode √©dition, clique sur un √©l√©ment puis "Style"<br>
‚Ä¢ Je peux te sugg√©rer des palettes de couleurs<br><br>
Quelle couleur pr√©f√®res-tu ? Bleu, vert, rouge, violet ?`;
} else if (lowerMessage.includes('image')) {
response = `Pour ajouter/modifier des images :<br>
‚Ä¢ Utilise <b>/image [description]</b> pour chercher<br>
‚Ä¢ En mode √©dition, clique sur une image existante<br>
‚Ä¢ Ajoute une nouvelle section "Image"<br><br>
Exemple: <b>/image restaurant moderne</b>`;
} else if (lowerMessage.includes('section')) {
response = `Tu peux ajouter des sections :<br>
‚Ä¢ Texte - paragraphes et contenu<br>
‚Ä¢ Image - photos et illustrations<br>
‚Ä¢ Bouton - liens et actions<br>
‚Ä¢ Titre - en-t√™tes et sous-titres<br><br>
Clique sur "Ajouter une section" √† droite !`;
} else {
// R√©ponses g√©n√©riques intelligentes
const responses = [
`C'est une excellente question ! Peux-tu me donner plus de d√©tails sur ce que tu cherches ?`,
`Je vois que tu travailles sur ton site. Comment puis-je t'aider √† l'am√©liorer ?`,
`Bonne id√©e ! Pour cela, je recommande d'utiliser le mode √©dition. Veux-tu que je t'explique comment faire ?`,
`Int√©ressant ! N'h√©site pas √† exp√©rimenter avec les couleurs et les styles. √áa peut transformer compl√®tement l'apparence !`,
`Super ! Si tu veux ajouter du contenu visuel, utilise la commande <b>/image [description]</b> pour trouver des images.`
];
response = responses[Math.floor(Math.random() * responses.length)];
}

addChatMessage(response, 'bot');
}

// Recherche d'images via API backend
async function searchImages(query) {
addChatMessage(`üîç Recherche d'images pour: "${query}"...`, 'bot');

try {
const response = await fetch('http://localhost:8001/api/images/search', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ query: query })
});

if (!response.ok) {
throw new Error(`HTTP error! status: ${response.status}`);
}

const data = await response.json();
console.log('Images re√ßues:', data);

if (data.success && data.images && data.images.length > 0) {
let imageResults = '<div class="image-search-result">';
data.images.forEach((image, index) => {
imageResults += `
<div class="image-item" style="position: relative; border-radius: 8px; overflow: hidden;">
<img src="${image.small_url}" alt="${image.alt_description}" 
     style="width: 100%; height: 120px; object-fit: cover; cursor: pointer;"
     onclick="selectSearchedImage('${image.url}', '${image.description}', '${image.id}')">
<div class="image-overlay" style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: white; padding: 8px; font-size: 12px;">
${image.description}
</div>
</div>
`;
});
imageResults += '</div>';

addChatMessage(`üì∏ Images pour "${query}" :<br>Clique sur une image pour l'utiliser !<br><br>${imageResults}`, 'bot');
} else {
addChatMessage(`‚ùå Aucune image trouv√©e pour "${query}". Essayez un autre terme.`, 'bot');
}
} catch (error) {
console.error('Erreur recherche d\'images:', error);
addChatMessage(`‚ùå Erreur lors de la recherche d'images. V√©rifiez que le serveur backend fonctionne.`, 'bot');
}
}

function selectSearchedImage(imageUrl, description, imageId) {
console.log('Image s√©lectionn√©e:', imageUrl, description, imageId);

// Demander o√π placer l'image avec options plus claires
const modal = document.createElement('div');
modal.className = 'modal';
modal.style.display = 'block';
modal.innerHTML = `
<div class="modal-content max-w-md">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Utiliser cette image</h2>
<button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
</div>
<div class="mb-4">
<img src="${imageUrl}" alt="${description}" style="width: 100%; border-radius: 8px; max-height: 200px; object-fit: cover;">
<p class="text-sm text-gray-600 mt-2">${description}</p>
</div>
<div class="space-y-3">
<button onclick="applyImageToElement('${imageUrl}', '${description}', 'replace'); this.closest('.modal').remove();" 
        class="w-full bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600 text-left">
<i class="fas fa-exchange-alt mr-2"></i>Remplacer une image existante
<div class="text-xs opacity-75">Clique ensuite sur l'image √† remplacer</div>
</button>
<button onclick="applyImageToElement('${imageUrl}', '${description}', 'add'); this.closest('.modal').remove();" 
        class="w-full bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600 text-left">
<i class="fas fa-plus mr-2"></i>Ajouter comme nouvelle section
<div class="text-xs opacity-75">Ajoute l'image en bas de la page</div>
</button>
<button onclick="applyImageToElement('${imageUrl}', '${description}', 'background'); this.closest('.modal').remove();" 
        class="w-full bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600 text-left">
<i class="fas fa-image mr-2"></i>Utiliser comme arri√®re-plan
<div class="text-xs opacity-75">Applique √† la section hero</div>
</button>
</div>
</div>
`;
document.body.appendChild(modal);
}

function applyImageToElement(imageUrl, description, mode) {
console.log('Application de l\'image:', mode, imageUrl);

if (mode === 'add') {
// Ajouter une nouvelle section
const previewEl = document.getElementById('websitePreview');
const newElement = document.createElement('div');
newElement.className = 'editable image-section';
newElement.style.padding = '20px';
newElement.style.textAlign = 'center';
newElement.innerHTML = `
<img src="${imageUrl}" alt="${description}" 
     style="width: 100%; max-width: 400px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"
     data-editable="image">
<p style="margin-top: 15px; color: #6b7280; font-style: italic;" data-editable="text">${description}</p>
`;

const mainContent = previewEl.querySelector('main') || previewEl;
mainContent.appendChild(newElement);
updateCurrentPageData();
if (editMode) {
makeElementsEditable();
}
addChatMessage(`‚úÖ Image ajout√©e comme nouvelle section !`, 'bot');

} else if (mode === 'background') {
// Appliquer comme arri√®re-plan
const heroSection = document.querySelector('[style*="background"]');
if (heroSection) {
const currentStyle = heroSection.getAttribute('style') || '';
const newStyle = currentStyle.replace(/background[^;]*;?/g, '') + 
                 `background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${imageUrl}'); background-size: cover; background-position: center;`;
heroSection.setAttribute('style', newStyle);
updateCurrentPageData();
addChatMessage(`‚úÖ Image appliqu√©e comme arri√®re-plan !`, 'bot');
} else {
addChatMessage(`‚ùå Aucune section d'arri√®re-plan trouv√©e.`, 'bot');
}

} else if (mode === 'replace') {
// Mode remplacement - stocker l'URL et attendre le clic
window.selectedImageForReplacement = imageUrl;
window.selectedImageDescription = description;

if (!editMode) {
// Activer le mode √©dition automatiquement
toggleEditMode();
}

addChatMessage(`‚úÖ Image pr√™te ! Clique maintenant sur l'image que tu veux remplacer (bordures bleues pointill√©es).`, 'bot');

// Ajouter un indicateur visuel
const style = document.createElement('style');
style.id = 'image-replacement-style';
style.innerHTML = `
.editable img:not([data-replacement-ready]) {
border: 3px solid #10b981 !important;
cursor: pointer !important;
animation: pulse-green 2s infinite;
}
@keyframes pulse-green {
0%, 100% { border-color: #10b981; }
50% { border-color: #34d399; }
}
`;
document.head.appendChild(style);

// Ajouter des event listeners aux images
setTimeout(() => {
const images = document.querySelectorAll('.editable img');
images.forEach(img => {
if (!img.dataset.replacementReady) {
img.dataset.replacementReady = 'true';
img.addEventListener('click', handleImageReplacement);
}
});
}, 500);
}
}

function handleImageReplacement(event) {
event.preventDefault();
event.stopPropagation();

const img = event.target;
const newUrl = window.selectedImageForReplacement;
const newDescription = window.selectedImageDescription;

if (newUrl) {
// Remplacer l'image
img.src = newUrl;
img.alt = newDescription;

// Nettoyer
delete window.selectedImageForReplacement;
delete window.selectedImageDescription;
const style = document.getElementById('image-replacement-style');
if (style) style.remove();

// Supprimer les event listeners
const images = document.querySelectorAll('.editable img');
images.forEach(img => {
img.removeEventListener('click', handleImageReplacement);
delete img.dataset.replacementReady;
});

updateCurrentPageData();
addChatMessage(`‚úÖ Image remplac√©e avec succ√®s !`, 'bot');
showNotification('‚úÖ Image remplac√©e !');
}
}
</script>
</body>
</html>
